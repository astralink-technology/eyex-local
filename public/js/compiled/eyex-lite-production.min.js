"use strict";angular.module("eyexApp.accountSettingsController",[]).controller("accountSettingsController",["$scope","$http","validationServices","countryServices",function(e,o,t,a){$("#tbPrimaryEmail").focus();for(var r=a.getCountries(),n=0;n<r.length;n++){var i='<option value="'+r[n].code+'">'+r[n].name+" (+"+r[n].code+")</option>";$("#ddlCountryCode").append(i),$("#ddlCountryCode2").append(i)}var c=function(){$("#loadAccount").modal({backdrop:"static",keyboard:!1});var t="?UserId="+_user_id;o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){if($("#loadAccount").modal("hide"),console.log(o.Data[0]),o.Error)window&&console.log(o.ErrorDesc);else{var t=o.Data[0],a=t.username;e.tbPrimaryEmail=a,e.tbPhoneNumber=t.sip,e.tbPhoneNumber2=t.sip2,$("#ddlCountryCode").val(t.sip_cc),$("#ddlCountryCode2").val(t.sip2_cc)}})};e.editAccountSettings=function(){var a=e.tbPrimaryEmail,r=$("#ddlCountryCode").val(),n=e.tbPhoneNumber,i=$("#ddlCountryCode2").val(),d=e.tbPhoneNumber2;r&&(r=parseInt(r)),i&&(i=parseInt(i));var s=t.validateEmail(a,!0);s?(e.primaryEmailError=!0,e.valPrimaryEmail=s):(e.valPrimaryEmail="",e.primaryEmailError=!1);var l=!1,u=!1;n&&(l=t.validateRequiredField(r,"Select Country Code"),u=t.validateRequiredInteger(n,!0,null,"Invalid Phone Number"),u||l?(e.phoneNumberError=!0,u&&(e.valPhoneNumber=u),l&&(e.valPhoneNumber=l)):(e.valPhoneNumber="",e.phoneNumberError=!1));var m=!1,p=!1;if(d){var m=t.validateRequiredField(i,"Select Country Code"),p=t.validateRequiredInteger(d,!0,null,"Invalid Phone Number");p||m?(e.phoneNumberError2=!0,p&&(e.valPhoneNumber2=p),m&&(e.valPhoneNumber2=m)):(e.valPhoneNumber2="",e.phoneNumberError2=!1)}if(s||u||p||m||l);else{$("#updateAccount").modal({backdrop:"static",keyboard:!1}),$("input").each(function(){$(this).blur()}),$("select").each(function(){$(this).blur()});var v=new Object;v.UserId=_user_id,v.Username=a,n?(v.SipCc=r,v.Sip=n):(v.SipCc="",v.Sip=""),d?(v.Sip2Cc=i,v.Sip2=d):(v.Sip2Cc="",v.Sip2=""),console.log(v),o.post("/eyex-lite/controllers/users/updateUser.php",v).success(function(o){console.log(o),o.Error?(e.overallError=!0,e.valError=o.ErrorDesc,window&&console.log(o.ErrorDesc)):(e.updateSuccess=!0,e.successMessage="Account details updated",e.overallError=!1,e.valError="",$("#updateAccount").modal("hide"),c())}).error(function(e){window&&console.log(e)})}},c()}]),angular.module("eyexApp.activitiesController",[]).controller("activitiesController",["$scope","$http","dateTimeServices","pageServices",function(e,o,t,a){e.activityFilter="",e.selectedEmployee="",e.selectedPageSize=20,e.selectedSkipSize=0;var r=function(o){e.selectedSkipSize=(o-1)*e.selectedPageSize,n()},n=function(){e.loadingActivities=!0,e.noActivities=!1,e.activitiesExists=!1,e.downloadCsvShow=!1;var n="";n+=e.selectedActivityType?"?ClockType="+e.selectedActivityType:"?ClockType=I,O,T,X,N",e.selectedEmployee&&(n+="&UserId="+e.selectedEmployee),e.selectedDoor&&(n+="&DoorId="+e.selectedDoor),e.selectedPageSize&&(n+="&PageSize="+e.selectedPageSize),e.selectedSkipSize&&(n+="&SkipSize="+e.selectedSkipSize),o.get("/eyex-lite/controllers/access/getAccess.php"+encodeURI(n)).success(function(o){if(e.loadingActivities=!1,o.RowsReturned>0){e.downloadCsvShow=!0;for(var n=0;n<o.RowsReturned;n++)o.Data[n].login_time=t.timeSince(moment(moment(o.Data[n].login_time).format("YYYY-MM-DDTHH:mm:ss+0000")).local()),"O"==o.Data[n].clock_type?o.Data[n].activity="Clocked out":"I"==o.Data[n].clock_type?o.Data[n].activity="Clocked in":"X"==o.Data[n].clock_type?o.Data[n].activity="Exited":"N"==o.Data[n].clock_type?o.Data[n].activity="Entered":"T"==o.Data[n].clock_type&&(o.Data[n].activity="Tap and accessed");e.activitiesExists=!0,e.activities=o.Data,e.selectedPageSize?($("#activityPager").html(""),e.currentPage=e.selectedSkipSize/e.selectedPageSize+1,e.numberOfPages=o.Data[0].total_rows/e.selectedPageSize,a.loadPager("#activityPager",e.numberOfPages,e.currentPage),$(".page-number").each(function(){var e=$(this).attr("data-pagenum");$(this).click(function(){r(e)})}),$("#nextPage").click(function(){e.currentPage!=e.numberOfPages&&r(e.currentPage+1)}),$("#prevPage").click(function(){1!=e.currentPage&&r(e.currentPage-1)})):$("#activityPager").html("")}else $("#activityPager").html(""),e.activities=o.Data,e.noActivities=!0})},i=function(){o.get("/eyex-lite/controllers/door/getDoor.php").success(function(e){if(e.RowsReturned>0)for(var o=0;o<e.RowsReturned;o++){var t='<option value="'+e.Data[o].door_id+'">'+e.Data[o].door_name+"</option>";$("#ddlDoors").append(t)}})},c=function(){$("#loadEmployeesModal").modal({backdrop:"static",keyboard:!1});var e="?Type=contact";e+="&AuthorizationLevel=300",o.get("/eyex-lite/controllers/users/getUserDetails.php"+encodeURI(e)).success(function(e){for(var o=0;o<e.RowsReturned;o++){var t='<option value="'+e.Data[o].id+'">'+e.Data[o].name+"</option>";$("#ddlEmployees").append(t)}})};e.exportCsv=function(){var o="?UserId="+e.selectedEmployee;e.selectedDoor&&(o+="&DoorId="+e.selectedDoor),e.selectedActivityType&&(o+="&ClockType="+e.selectedActivityType),$.get("/eyex-lite/controllers/access/getAccessCsv.php",o,function(){document.location.href="/eyex-lite/controllers/access/getAccessCsv.php"+o})},$("#ddlEmployees").on("change",function(){var o=$(this).val();e.selectedEmployee=o,n()}),$("#ddlDoors").on("change",function(){var o=$(this).val();e.selectedDoor=o,n()}),$("#ddlActivity").on("change",function(){var o=$(this).val();e.selectedActivityType=o,n()}),$("#ddlPageSize").on("change",function(){var o=$(this).val();e.selectedPageSize=o,n()}),n(),c(),i()}]),angular.module("eyexApp.announcementsController",[]).controller("announcementsController",["$scope","$http","$rootScope",function(e,o){$("#taAnnouncement").focus();var t=function(){$("#loadAnnouncement").modal({keyboard:!1,backdrop:"static"}),o.get("/eyex-lite/controllers/announcements/getAnnouncement.php").success(function(o){if(o.RowsReturned>0){var t=o.Data[0].message,a=o.Data[0].id;e.taAnnouncement=t,e.announcementId=a}$("#loadAnnouncement").modal("hide"),$("#taAnnouncement").focus()})};e.postAnnouncement=function(){var t=e.taAnnouncement,a=new Object;a.Message=t,$("#updatingAnnouncement").modal({keyboard:!1,backdrop:"static"}),e.announcementId?(a.AnnouncementId=e.announcementId,o.post("/eyex-lite/controllers/announcements/updateAnnouncement.php",a).success(function(o){console.log(o),o.Error?(e.overallError=!0,e.valError=o.ErrorDesc):(e.successMessage="Announcement updated!",e.updateSuccess=!0),$("#updatingAnnouncement").modal("hide"),$("#taAnnouncement").blur()}).error(function(e){window&&console.log(e)})):o.post("/eyex-lite/controllers/announcements/addAnnouncement.php",a).success(function(o){console.log(o),o.Error?(e.overallError=!0,e.valError=o.ErrorDesc):(e.successMessage="Announcement updated!",e.updateSuccess=!0),$("#updatingAnnouncement").modal("hide"),$("#taAnnouncement").blur()}).error(function(e){window&&console.log(e)})},t()}]),angular.module("eyexApp.cardAccessController",[]).controller("cardAccessController",["$scope","$http",function(e,o){$("#tbCardId").focus();var t=function(){$("#modalLoadCard").modal({backdrop:"static",keyboard:!1});var t="?UserId="+_user_id;o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){$("#modalLoadCard").modal("hide"),o.RowsReturned>0&&(e.tbCardId=o.Data[0].card_id)})};e.changeCard=function(){var a=e.tbCardId;$("#modalChangeCard").modal({backdrop:"static",keyboard:!1}),$("input").each(function(){$(this).blur()});var r=new Object;r.CardId=a,_user_id&&(r.UserId=_user_id),o.post("/eyex-lite/controllers/users/updateCard.php",r).success(function(o){console.log(o),o.Error?($("#modalChangeCard").modal("hide"),$("#tbCardId").focus(),"CardId In Use"==o.ErrorDesc&&(e.cardIdError=!0,e.valCardId="Card ID has been taken. Is this your card?")):($("#modalChangeCard").modal("hide"),e.successMessage="Access Card ID changed successfully",e.updateSuccess=!0,$("#tbCardId").focus(),t())}).error(function(e){window&&console.log(e)})},t()}]),angular.module("eyexApp.changePasswordController",[]).controller("changePasswordController",["$scope","$http","validationServices",function(e,o,t){$("#tbCurrentPassword").focus();var a=function(){e.tbCurrentPassword="",e.tbNewPassword="",e.tbConfirmPassword="",$("#tbCurrentPassword").focus()};e.changePassword=function(){var r=e.tbCurrentPassword,n=e.tbNewPassword,i=e.tbConfirmPassword,c=t.validateRequiredField(r),d=t.validateRequiredLength(n,!0,null,8,"Password needs to bee 8 characters long"),s=t.validateRequiredSimilarField(i,!0,null,n,"New passwords does not match");if(c?(e.passwordError=!0,e.valPassword=c):(e.valPassword="",e.passwordError=!1),d?(e.newPasswordError=!0,e.valNewPassword=d):(e.valNewPassword="",e.newPasswordError=!1),s?(e.confirmPasswordError=!0,e.valConfirmPassword=s):(e.valConfirmPassword="",e.confirmPasswordError=!1),c||d||s);else{$("#modalChangePassword").modal({backdrop:"static",keyboard:!1}),e.overallError=!1,e.passwordError=!1,e.updateSuccess=!1,$("input").each(function(){$(this).blur()}),$("#modalChangePassword").modal({backdrop:"static",keyboard:!1}),e.overallError=!1,e.passwordError=!1,e.updateSuccess=!1,$("input").each(function(){$(this).blur()});var l=new Object;l.UserId=_user_id,l.OldPassword=r,l.NewPassword=n,o.post("/eyex-lite/controllers/account/changePassword.php",l).success(function(o){console.log(o),$("#modalChangePassword ").modal("hide"),o.Error?"Old Password Incorrect"==o.ErrorDesc?(e.passwordError=!0,e.valPassword="Old password does not match."):window&&console.log(o.ErrorDesc):(e.passwordError=!1,e.valPassword="",e.updateSuccess=!0,e.successMessage="Password Changed",e.overallError=!1,e.valError="",a())}).error(function(e){window&&console.log(e)})}}}]),angular.module("eyexApp.changePinController",[]).controller("changePinController",["$scope","$http","validationServices","$rootScope",function(e,o,t){$("#tbCurrentPin").focus();var a=function(){e.tbCurrentPin="",e.tbNewPin="",e.tbConfirmPin="",$("#tbCurrentPin").focus()};e.changePin=function(){var r=e.tbCurrentPin,n=e.tbNewPin,i=e.tbConfirmPin,c=t.validateRequiredLength(n,!0,null,4,"PIN needs to be at least 4 characters long"),d=t.validateRequiredSimilarField(i,!0,null,n,"New PINs does not match");if(c?(e.newPinError=!0,e.valNewPin=c):(e.valNewPin="",e.newPinError=!1),d?(e.confirmPinError=!0,e.valConfirmPin=d):(e.valConfirmPin="",e.confirmPinError=!1),c||d);else{$("#modalChangePin").modal({backdrop:"static",keyboard:!1}),e.overallError=!1,e.pinError=!1,e.updateSuccess=!1,$("input").each(function(){$(this).blur()});var s=new Object;s.UserId=_user_id,s.OldPin=r,s.NewPin=n,o.post("/eyex-lite/controllers/users/updatePin.php",s).success(function(o){console.log(o),o.Error?($("#modalChangePin").modal("hide"),$("#tbCurrentPin").focus(),"Old PIN Incorrect"==o.ErrorDesc?(e.pinError=!0,e.valPin=o.ErrorDesc):"PIN In Use"==o.ErrorDesc?(e.newPinError=!0,e.valNewPin="PIN already taken"):window&&console.log(o.ErrorDesc)):($("#modalChangePin").modal("hide"),e.overallError=!1,e.pinError=!1,e.newPinError=!1,e.successMessage="PIN changed successfully",e.updateSuccess=!0,a())}).error(function(e){window&&console.log(e)})}}}]),angular.module("eyexApp.cloudAccessibilityController",[]).controller("cloudAccessibilityController",["$scope","$http","validationServices",function(e,o,t){var a=function(e){Pusher.log=function(e){window.console&&window.console.log&&window.console.log(e)};var t=new Pusher("8a7c33f8bae0cc471cac"),a=t.subscribe(e);a.bind("eyex_sync",function(e){console.log("connected");var t=new Object;t.Data=e,o.post("/eyex-lite/controllers/sync/syncRemoteToLocal.php",JSON.stringify(t)).success(function(e){window&&console.log(e)}).error(function(e){window&&console.log(e)})})};e.cloudAccountExists=!1,e.cloudConnected=!1;var r=function(){$("#loadCloudModal").modal({keyboard:!1,backdrop:"static"}),o.get("/eyex-lite/controllers/cloudAccess/getCloudInfo.php").success(function(o){if($("#loadCloudModal").modal("hide"),o.RowsReturned>0){var t=o.Data[0];console.log(t),e.cloudSecret=t.secret,e.cloudUsername=t.authentication_string,e.cloudToken=t.token,e.cloudAccessId=t.cloud_access_id,e.cloudAccessId&&a(e.cloudAccessId),$("#signupCloud").hide()}else $("#signupCloud").show()})};r(),e.createCloudAccess=function(){var a=e.tbCloudAccessUsername,n=e.tbCloudPassword,i=e.tbCloudPasswordConfirm,c=t.validateRequiredField(a),d=t.validateRequiredField(n),s=t.validateRequiredSimilarField(i,!0,null,n,"Password does not match");if(c?(e.cloudAccessUsernameError=!0,e.valCloudAccessUsername=c):(e.valCloudAccessUsername="",e.cloudAccessUsernameError=!1),d?(e.cloudAccessPasswordError=!0,e.valCloudAccessPassword=d):(e.valCloudAccessPassword="",e.cloudAccessPasswordError=!1),s?(e.cloudAccessPasswordConfirmError=!0,e.valCloudAccessPasswordConfirm=d):(e.valCloudAccessPasswordConfirm="",e.cloudAccessPasswordConfirmError=!1),!(c||d||s)){$("#signupCloudModal").modal({keyboard:!1,backdrop:"static"});var l=new Object;l.DeviceId=e.cloudDeviceId,l.Password=n,l.AuthenticationString=a,l.Name=_name,o.post("/eyex-lite/controllers/cloudAccess/signupCloud.php",l).success(function(o){$("#signupCloudModal").modal("hide"),console.log(o),o.Error?"UserExists"==o.ErrorDesc&&(e.cloudAccessUsernameError=!0,e.valCloudAccessUsername="User email taken"):r()}).error(function(e){window&&console.log(e)})}}}]),angular.module("eyexApp.companyAccountController",[]).controller("companyAccountController",["$scope","$http","countryServices","validationServices",function(e,o,t,a){for(var r=t.getCountries(),n=0;n<r.length;n++){var i='<option value="'+r[n].code+'">'+r[n].name+" (+"+r[n].code+")</option>";$("#ddlCountryCode").append(i)}var c=function(){$("#loadCompanyAccount").modal({backdrop:"static",keyboard:!1});var t="?UserId="+_user_id;o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){if(o.RowsReturned>0){$("#loadCompanyAccount").modal("hide");var t=o.Data[0],a=t.id,r=t.username,n=t.sip,i=t.sip_cc;e.tbCompanyEmail=r,e.tbCompanyPhone=n,e.companyId=a,$("#ddlCountryCode").val(i)}})};e.editCompanyAccountSettings=function(){var t=e.tbCompanyEmail,r=$("#ddlCountryCode").val(),n=e.tbCompanyPhone,i=a.validateEmail(t,!0);i?(e.companyEmailError=!0,e.valCompanyEmail=i):(e.valCompanyEmail="",e.companyEmailError=!1);var d=!1,s=!1;if(n&&(d=a.validateRequiredField(r,"Select Country Code"),s=a.validateRequiredInteger(n,!0,null,"Invalid Phone Number"),s||d?(e.companyPhoneError=!0,s&&(e.valCompanyPhone=s),d&&(e.valCompanyPhone=d)):(e.valCompanyPhone="",e.companyPhoneError=!1)),i||s||d);else{$("#updatingCompanyAccount").modal({backdrop:"static",keyboard:!1}),$("input").each(function(){$(this).blur()}),$("select").each(function(){$(this).blur()});var l=new Object;l.UserId=_user_id,l.Username=t,n?(l.Sip=n,l.SipCc=r):(l.Sip="",l.SipCc=""),o.post("/eyex-lite/controllers/users/updateUser.php",l).success(function(o){o.Error?(e.overallError=!0,e.valError=o.ErrorDesc,window&&console.log(o.ErrorDesc)):(e.updateSuccess=!0,e.successMessage="Company account details updated",e.overallError=!1,e.valError="",$("#updatingCompanyAccount").modal("hide"),c())}).error(function(e){window&&console.log(e)})}},c()}]),angular.module("eyexApp.companyController",[]).controller("companyController",["$scope","$http","dateTimeServices","eyexServices",function(e,o,t){e.slideInterval=5e3,e.reportedToWork=0,e.inOffice=0,e.away=0;var a=function(){e.loadAnnouncements=!0,o.get("/eyex-lite/controllers/announcements/getAnnouncement.php").success(function(o){if(e.loadAnnouncements=!1,o.RowsReturned>0){e.announcementsExists=!0;var t=o.Data[0].message;e.announcement=t}else e.noAnnouncements=!0})},r=function(){e.loadProfile=!0;var t="?AuthorizationLevel=400";o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){if(console.log(o),o.RowsReturned>0){e.loadProfile=!1;var t=o.Data[0];if(t.sip_cc&&t.sip){e.profilePhone=!0;var a="+("+t.sip_cc+") "+t.sip;"1800"==t.sip_cc&&(a=t.sip_cc+t.sip+" (Toll Free)"),e.phone=a}if(t.username&&(e.profileEmail=!0,e.email=t.username),t.name&&(e.companyName=t.name),t.apartment||t.street_1||t.suite||t.postcode||t.country){var r="";t.apartment&&(r+=t.apartment+" "),t.street_1&&(r+=t.street_1+" "),t.suite&&(r+="#"+t.suite+", "),t.country&&(r+=t.country+" "),t.postcode&&(r+=t.postcode),e.address=r,e.profileAddress=!0}if(t.extra_data2&&t.extra_data3&&(e.profileWebsite=!0,e.webAddress=t.extra_data2+t.extra_data3,e.webAddressLink=t.extra_data2+t.extra_data3),t.extra_date_time&&t.extra_date_time2&&t.extra_data){if(e.profileBizHours=!0,t.extra_data){for(var n=t.extra_data.split(","),i="",c=!1,d=!1,s=!1,l=!1,u=!1,m=!1,p=!1,v=0;v<n.length;v++)"1"==n[v]?c=!0:"2"==n[v]?d=!0:"3"==n[v]?s=!0:"4"==n[v]?l=!0:"5"==n[v]?u=!0:"6"==n[v]?m=!0:"7"==n[v]&&(p=!0);c&&d&&s&&l&&u&&m&&p?i+="Daily, ":c&&d&&s&&l&&u||m&&p?(c&&d&&s&&l&&u&&(i+="Weekdays, "),m&&p&&(i+="Weekends, ")):(c&&(i+="Monday, "),d&&(i+="Tuesday, "),s&&(i+="Wednesday, "),l&&(i+="Thursday, "),u&&(i+="Friday, "),m&&(i+="Saturday, "),p&&(i+="Sunday, ")),t.extra_date_time&&(i+=moment(moment(moment(t.extra_date_time).format("YYYY-MM-DDTHH:mm:ss+0000")).local()).format("h:mma")+" - "),t.extra_date_time2&&(i+=moment(moment(moment(t.extra_date_time2).format("YYYY-MM-DDTHH:mm:ss+0000")).local()).format("h:mma"))}else i="";e.workHours=i}t.co_logo?(e.profileLogo=!0,$("#profilePicUrl").prop("src",t.co_logo)):e.noLogoUploaded=!0}})},n=function(t){if(e.loadEcosystem=!0,t){var a="?DeviceCode="+t;o.get("http://23.21.214.219/Dashboard/DashboardHandler.php"+encodeURI(a)).success(function(o){if(e.loadEcosystem=!1,o.totalRowsAvailable>0){var t=o.data[0].deviceStatus,a=JSON.parse(t);if(a.length>0){e.ecosystemExists=!0;for(var r=0;r<a.length;r++)a[r].nodeName&&(a[r].name=a[r].nodeName,a[r].nodeName=a[r].nodeName.toLowerCase(),a[r].icon=null),a[r].data=null,"dimmer"==a[r].nodeName?(a[r].icon="/eyex-lite/public/img/power-monitor-xs.png",a[r].data=a[r].status):"multi sensor"==a[r].nodeName?a[r].icon="/eyex-lite/public/img/multisensor-xs.png":"power meter"==a[r].nodeName?(a[r].icon="/eyex-lite/public/img/power-meter-xs.png",a[r].data=a[r].sensorVal):"door lock"==a[r].nodeName?(a[r].icon="/eyex-lite/public/img/doorlock-xs.png",a[r].data=a[r].mode):"contact sensor"==a[r].nodeName&&(a[r].icon="/eyex-lite/public/img/contact-sensor-xs.png");e.sensors=a}else e.noEcosystem=!0}else e.noEcosystem=!0})}else e.loadEcosystem=!1,e.noEcosystem=!0},i=function(){e.loadStaffStrength=!0;var t="?Type=contact";t+="&AuthorizationLevel=300",o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){if(e.loadStaffStrength=!1,e.staffStrengthLoaded=!0,e.staffStrength=o.RowsReturned,o.RowsReturned>0){var t=$linq(o.Data).where("x => x.status != 'P'").where("x => x.status != 'A'").toArray(),a=t.length,r=$linq(o.Data).where("x => x.status == 'I'").toArray(),n=r.length,i=$linq(o.Data).where("x => x.status == 'A'").toArray(),c=i.length;e.reportedToWork=a,e.inOffice=n,e.away=c}})},c=function(){e.loadInOffice=!0;var t="?Status=I";t+="&Type=contact",o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){e.inOfficeCount=o.RowsReturned,e.loadInOffice=!1,o.RowsReturned>0?(e.inOfficeExists=!0,e.inOfficeStaff=o.Data):e.noInOffice=!0})},d=function(){e.loadAway=!0;var t="?Status=A";t+="&Type=contact",o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){e.loadAway=!1,e.awayCount=o.RowsReturned,o.RowsReturned>0?(e.awayExists=!0,e.awayStaff=o.Data):e.noAway=!0})},s=function(){e.loadOvertime=!0;var t="?Status=O";t+="&Type=contact",o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){e.overtimeCount=o.RowsReturned,e.loadLate=!1,o.RowsReturned>0?e.lateExists=!0:e.noLate=!0})},l=function(){e.loadOvertime=!0;var t="?Status=L";t+="&Type=contact",o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){e.lateForWorkCount=o.RowsReturned,e.loadOvertime=!1,o.RowsReturned>0?e.overtimeExists=!0:e.noOvertime=!0})},u=function(){o.get("/eyex-lite/controllers/device/getDevice.php").success(function(o){console.log(o);var t=new Array;if(o.RowsReturned>0){for(var a=0;a<o.RowsReturned;a++)if("VS"==o.Data[a].device_type){var r=o.Data[a].device_id+"-888",i=o.Data[a].device_id+"-999";e.VisitorStationId=o.Data[a].device_id,t.push(r),t.push(i)}else"RFID"==o.Data[a].device_type?t.push(o.Data[a].device_id):"OS"==o.Data[a].device_type&&(e.OfficeStationId=o.Data[a].device_id);n(e.OfficeStationId)}})},m=function(){e.loadActivities=!0;var a="";a+="?ClockType=I,O,T,X,N",a+="&SkipSize=0",a+="&PageSize=15",o.get("/eyex-lite/controllers/access/getAccess.php"+encodeURI(a)).success(function(o){if(e.loadActivities=!1,o.RowsReturned>0){for(var a=0;a<o.RowsReturned;a++)o.Data[a].login_time=t.timeSince(moment(moment(o.Data[a].login_time).format("YYYY-MM-DDTHH:mm:ss+0000")).local()),"O"==o.Data[a].clock_type?o.Data[a].activity="Clocked out":"I"==o.Data[a].clock_type?o.Data[a].activity="Clocked in":"X"==o.Data[a].clock_type?o.Data[a].activity="Exited":"N"==o.Data[a].clock_type?o.Data[a].activity="Entered":"T"==o.Data[a].clock_type&&(o.Data[a].activity="Tap and accessed");e.activitiesExists=!0,e.activities=o.Data}else e.noActivities=!0})};a(),r(),i(),c(),d(),s(),l(),u(),m()}]),angular.module("eyexApp.companyPasswordController",[]).controller("companyPasswordController",["$scope","$http","validationServices",function(e,o,t){$("#tbCurrentPassword").focus();var a=function(){e.tbCurrentPassword="",e.tbNewPassword="",e.tbConfirmPassword="",$("#tbCurrentPassword").focus()};e.changeCompanyPassword=function(){var r=e.tbCurrentPassword,n=e.tbNewPassword,i=e.tbConfirmPassword,c=t.validateRequiredField(r),d=t.validateRequiredLength(n,!0,null,8,"Password needs to bee 8 characters long"),s=t.validateRequiredSimilarField(i,!0,null,n,"Passwords do not match");if(c?(e.passwordError=!0,e.valPassword=c):(e.valPassword="",e.passwordError=!1),d?(e.newPasswordError=!0,e.valNewPassword=d):(e.valNewPassword="",e.newPasswordError=!1),s?(e.confirmPasswordError=!0,e.valConfirmPassword=s):(e.valConfirmPassword="",e.confirmPasswordError=!1),c||d||s);else{$("#modalChangePassword").modal({backdrop:"static",keyboard:!1}),e.overallError=!1,e.passwordError=!1,e.updateSuccess=!1,$("input").each(function(){$(this).blur()});var l=new Object;l.UserId=_user_id,l.OldPassword=r,l.NewPassword=n,o.post("/eyex-lite/controllers/account/changePassword.php",l).success(function(o){$("#modalChangePassword ").modal("hide"),o.Error?"Old Password Incorrect"==o.ErrorDesc?(e.passwordError=!0,e.valPassword="Old password does not match."):window&&console.log(o.ErrorDesc):(e.passwordError=!1,e.valPassword="",e.updateSuccess=!0,e.successMessage="Password Changed",e.overallError=!1,e.valError="",a())}).error(function(e){window&&console.log(e)})}}}]),angular.module("eyexApp.completeInvitationController",[]).controller("completeInvitationController",["$scope","$http","$location","validationServices",function(){}]),angular.module("eyexApp.devicesController",[]).controller("devicesController",["$scope","$http","validationServices",function(e,o,t){var a=0;e.addDeviceType=null,e.deviceListing=!0,e.toggleDoors=function(){e.doorListing=!0,e.deviceListing=!1,$(".nav-stacked li").removeClass("active"),$("#navDoors").addClass("active"),r()},e.toggleDevices=function(){e.deviceListing=!0,e.doorListing=!1,$(".nav-stacked li").removeClass("active"),$("#navDevices").addClass("active"),s()},$(".tb-mac-address").each(function(){$(this).keyup(function(){2==$(this).val().length&&$(this).parent().next().find('[type="text"]').length>0&&$(this).parent().next().find('[type="text"]')[0].focus()})});var r=function(){$("#loadDoors").modal({keyboard:!1,backdrop:"static"}),o.get("/eyex-lite/controllers/door/getDoor.php").success(function(o){$("#loadDoors").modal("hide"),!o.Error&&o.RowsReturned>0&&(e.doors=o.Data)})},n=function(){e.tbDoorName="",e.tbDoorNode="",$("#doorNameError").hide(),$("#doorNodeError").hide(),e.addDoorForm=!0,e.addingDoor=!1},i=function(){o.get("/eyex-lite/controllers/door/getDoor.php").success(function(e){console.log(e);var o='<option value="">Select Door</option>';if(e.RowsReturned>0)for(var t=0;t<e.RowsReturned;t++)o+='<option value="'+e.Data[t].door_id+'">'+e.Data[t].door_name+"</option>";$("#ddlRfidAddDoor").html(o),$("#ddlRfidPinAddDoor").html(o),$("#ddlVsAddDoor").html(o)})},c=function(t){$("#ddlEditClockType").val("");var a="?DeviceId="+e.editDeviceId;o.get("/eyex-lite/controllers/door/getDoor.php"+encodeURI(a)).success(function(e){if(e.RowsReturned>0){for(var o='<option value="">Select Door</option>',a=0;a<e.RowsReturned;a++)o+='<option value="'+e.Data[a].door_id+'">'+e.Data[a].door_name+"</option>";$("#ddlEditDoor").html(o)}$("#ddlEditDoor").val(t)})},d=function(){e.addDeviceFormContent=!0,e.tbRfidDeviceName="",e.tbRfidDeviceId="",e.tbRfidPinDeviceName="",e.tbRfidPinDeviceId="",$("#ddlRfidPinClocktype").val(""),$("#ddlRfidClocktype").val(""),$(".tb-mac-address").each(function(){$(this).val("")}),$(".tb-device-name").each(function(){$(this).val("")}),$("#ddlDeviceTypes").html('<option value="">Choose device type</option>'),o.get("/eyex-lite/controllers/device/getDeviceDoorDetails.php").success(function(o){$("#loadDevices").modal("hide"),$(".add-device-form").hide(),e.devices=o.Data;var t=!1,r=!1;if(o.RowsReturned>0)for(var n=0;n<o.Data.length;n++)"OS"==o.Data[n].device_type?t=!0:"VS"==o.Data[n].device_type&&(r=!0);if(8>a){var i='<option value="CR">Card Reader</option>';i+='<option value="PCR">PIN Card Reader</option>'}t||(i+='<option value="OS">Office Station</option>'),r||(i+='<option value="VS">Visitor Station</option>'),$("#ddlDeviceTypes").append(i)})};$("#ddlDeviceTypes").change(function(){$(".alert-sm").hide(),$("#addOfficeStation").hide(),$("#addVisitorStation").hide(),$("#addRfidCardReader").hide(),$("#addRfidPinCardReader").hide();var o=$("#ddlDeviceTypes").val();o?($("#btnAddDevice").show(),"OS"==o?($("#addOfficeStation").show(),e.addDeviceType="OS"):"VS"==o?($("#addVisitorStation").show(),e.addDeviceType="VS"):"CR"==o?($("#addRfidCardReader").show(),e.addDeviceType="CR"):"PCR"==o?($("#addRfidPinCardReader").show(),e.addDeviceType="PCR"):e.addDeviceType=null):$("#btnAddDevice").hide(),i()});var s=function(){a=0,$("#loadDevices").modal({keyboard:!1,backdrop:"static"}),o.get("/eyex-lite/controllers/device/getDeviceDoorDetails.php").success(function(o){$("#loadDevices").modal("hide"),e.devices=o.Data;var t=!1,r=!1;if(o.RowsReturned>0)for(var n=0;n<o.Data.length;n++)"OS"==o.Data[n].device_type?t=!0:"VS"==o.Data[n].device_type&&(r=!0),("PCR"==o.Data[n].device_type||"CR"==o.Data[n].device_type)&&(a+=1);var i='<option value="CR">RFID Card Reader</option>';i+='<option value="PCR">RFID PIN Card Reader</option>',t||(i+='<option value="OS">Office Station</option>'),r||(i+='<option value="VS">Visitor Station</option>'),$("#ddlDeviceTypes").append(i),setTimeout(function(){$(".badge").each(function(){$(this).tooltip()})},300)})},l=function(t){var a=new Array;$(".user-authorized").each(function(){if($(this).is(":checked")){var e=$(this).val();a.push(e)}});var r=JSON.stringify(a),n=new Object;n.DeviceId=e.editDeviceId,n.UserIds=r,o.post("/eyex-lite/controllers/deviceRelationship/assignDeviceEmployeeAuth.php",n).success(function(e){e.Error?window&&console.log(e):t()}).error(function(e){window&&console.log(e)})};e.editDoor=function(){var a=e.tbEditDoorName,n=e.tbEditDoorNode,i=t.validateRequiredField(a),c=t.validateRequiredField(n);if(i?(e.editDoorNameError=!0,e.valEditDoorName=i):(e.valEditDoorName="",e.editDoorNameError=!1),c?(e.editDoorNodeError=!0,e.valEditDoorNode=c):(e.valEditDoorNode="",e.editDoorNodeError=!1),!i&&!c){e.editDoorContent=!1,e.editingDoorContent=!0;var d=new Object;d.DoorId=e.editDoorId,d.DoorName=a,d.DoorNode=n,o.post("/eyex-lite/controllers/door/updateDoor.php",d).success(function(o){e.editingDoorContent=!1,o.Error?"Node In Use"==o.ErrorDesc?(e.editDoorNodeError=!0,e.valEditDoorNode="Door Node already taken"):window&&console.log(o):($("#editDoorForm").modal("hide"),r())}).error(function(e){window&&console.log(e)})}},e.editDevice=function(){var a=e.tbEditDeviceName,r=$("#ddlEditDoor").val(),n=$("#ddlEditClockType").val(),i=t.validateRequiredField(a);if(i?(e.editDeviceNameError=!0,e.valEditDeviceName=i):(e.valEditDeviceName="",e.editDeviceNameError=!1),!i){e.editDeviceContent=!1,e.editingDevice=!0;var c=new Object;c.DeviceId=e.editDeviceId,c.DeviceName=a,(n||""==n)&&(c.Type3=n),o.post("/eyex-lite/controllers/device/updateDevice.php",c).success(function(o){o.Error?window&&console.log(o):"OS"==e.editDeviceTypeRaw?($("#editDeviceForm").modal("hide"),s()):l(function(){p(e.editDeviceId,r,function(){e.editingDevice=!1,$("#editDeviceForm").modal("hide"),s()})})}).error(function(e){window&&console.log(e)})}},e.editDoorPopup=function(o,t,a){e.editDoorContent=!0,e.editDoorFormControls=!0,e.confirmDeleteDoorExists=!1,e.deletingDoor=!1,e.openingDoor=!1,e.editDoorNodeError=!1,$("#editDoorForm").modal({keyboard:!1,backdrop:"static"}),e.editDoorId=o,e.editDoorNode=t,e.tbEditDoorName=a,e.tbEditDoorNode=t},e.editDevicePopup=function(o,t,a,r,n){e.editDeviceContent=!0,e.editDeviceFormControls=!0,e.confirmDeleteDeviceExists=!1,e.noEcosystem=!1,e.noEmployeesAuth=!1,e.employeeAuthExists=!1,e.ecosystemExists=!1,$("#editDeviceForm").modal({keyboard:!1,backdrop:"static"});var i="Device";"OS"==o?i="Office Station":"VS"==o?i="Visitor Station":"CR"==o?i="RFID Card Reader":"PCR"==o&&(i="RFID PIN Card Reader"),e.editDeviceId=t,e.editDeviceTypeRaw=o,e.editDeviceType=i,e.editDeviceName=a,e.tbEditDeviceName=a,"OS"==o?(e.btnAuthorizeAll=!1,e.btnDeauthorizeAll=!1,u(t)):("VS"==o||"PCR"==o||"CR"==o)&&(e.btnAuthorizeAll=!0,e.btnDeauthorizeAll=!0,m(t),c(r),n&&$("#ddlEditClockType").val(n))},e.authorizeAll=function(){$(".user-authorized").each(function(){$(this).prop("checked","checked")})},e.deauthorizeAll=function(){$(".user-authorized").each(function(){$(this).prop("checked",!1)})};var u=function(t){if(e.loadEcosystem=!0,t){var a="?DeviceCode="+t;o.get("http://23.21.214.219/Dashboard/DashboardHandler.php"+encodeURI(a)).success(function(o){if(e.loadEcosystem=!1,o.totalRowsAvailable>0){var t=o.data[0].deviceStatus,a=JSON.parse(t);if(a.length>0){e.ecosystemExistsRaw=!0,e.ecosystemExists=!0;for(var r=0;r<a.length;r++)a[r].nodeName&&(a[r].name=a[r].nodeName,a[r].nodeName=a[r].nodeName.toLowerCase(),a[r].icon=null),a[r].data=null,"dimmer"==a[r].nodeName?(a[r].icon="/eyex-lite/public/img/power-monitor-xs.png",a[r].data=a[r].status):"multi sensor"==a[r].nodeName?a[r].icon="/eyex-lite/public/img/multisensor-xs.png":"power meter"==a[r].nodeName?(a[r].icon="/eyex-lite/public/img/power-meter-xs.png",a[r].data=a[r].sensorVal):"door lock"==a[r].nodeName?(a[r].icon="/eyex-lite/public/img/doorlock-xs.png",a[r].data=a[r].mode):"contact sensor"==a[r].nodeName&&(a[r].icon="/eyex-lite/public/img/contact-sensor-xs.png");e.sensors=a}else e.ecosystemExistsRaw=!1,e.noEcosystem=!0}else e.ecosystemExistsRaw=!1,e.noEcosystem=!0})}else e.loadEcosystem=!1,e.noEcosystem=!0},m=function(t){if(e.loadEmployeesAuth=!0,t){var a="?DeviceId="+t;o.get("/eyex-lite/controllers/users/getEmployeeDeviceAuthentication.php"+encodeURI(a)).success(function(o){e.loadEmployeesAuth=!1,o.RowsReturned>0?(e.employeeDeviceAuthentications=o.Data,e.employeeAuthExistsRaw=!0,e.employeeAuthExists=!0):(e.employeeAuthExistsRaw=!1,e.noEmployeesAuth=!0)})}else e.employeeAuthExistsRaw=!1,e.loadEmployeesAuth=!1,e.noEmployeesAuth=!0},p=function(e,t,a){var r=new Object;r.DeviceId=e,r.DoorId=t,o.post("/eyex-lite/controllers/doorRelationship/pairDoor.php",r).success(function(e){console.log(e),e.Error?window&&console.log(e):a()}).error(function(e){window&&console.log(e)})};e.confirmDeleteDoor=function(){e.editDoorFormControls=!1,e.confirmDeleteDoorExists=!0},e.confirmDeleteDevice=function(){e.editDeviceFormControls=!1,e.ecosystemExists=!1,e.employeeAuthExists=!1,e.noEcosystem=!1,e.noEmployeesAuth=!1,e.confirmDeleteDeviceExists=!0},e.deleteDoor=function(){e.confirmDeleteDoorExists=!1,e.deletingDoor=!0;
var t=new Object;t.DoorId=e.editDoorId,o.post("/eyex-lite/controllers/door/deleteDoorDetail.php",t).success(function(o){$("#editDoorForm").modal("hide"),e.deletingDoor=!1,o.Error?window&&console.log(o):r()}).error(function(e){window&&console.log(e)})},e.deleteDevice=function(){e.confirmDeleteDeviceExists=!1,e.deletingDevice=!0;var t=new Object;t.DeviceId=e.editDeviceId,o.post("/eyex-lite/controllers/device/deleteDeviceDetail.php",t).success(function(o){$("#editDeviceForm").modal("hide"),e.deletingDevice=!1,o.Error?window&&console.log(o):s()}).error(function(e){window&&console.log(e)})},e.deleteDoorCancel=function(){e.editDoorFormControls=!0,e.confirmDeleteDoorExists=!1},e.deleteDeviceCancel=function(){e.confirmDeleteDeviceExists=!1,e.editDeviceFormControls=!0;{var o=e.editDeviceTypeRaw;e.editDeviceId}"OS"==o?(e.ecosystemExistsRaw?e.ecosystemExists=!0:e.noEcosystem=!0,e.btnAuthorizeAll=!1,e.btnDeauthorizeAll=!1):("VS"==o||"CR"==o||"PCR"==o)&&(e.employeeAuthExistsRaw?e.employeeAuthExists=!0:e.noEmployeesAuth=!0,e.btnAuthorizeAll=!0,e.btnDeauthorizeAll=!0)},e.addDoor=function(){var a=e.tbDoorName,i=e.tbDoorNode,c=t.validateRequiredField(a),d=t.validateAlphaNumeric(i,!0);if(c?($("#doorNameError").show(),$("#doorNameError").text(c)):($("#doorNameError").hide(),$("#doorNameError").text("")),d?($("#doorNodeError").show(),$("#doorNodeError").text(d)):($("#doorNodeError").hide(),$("#doorNodeError").text("")),!d&&!c){e.addDoorForm=!1,e.addingDoor=!0;var s=new Object;s.DoorName=a,s.DoorNode=i,o.post("/eyex-lite/controllers/door/addDoor.php",s).success(function(o){e.addingDoor=!1,o.Error?"Node In Use"==o.ErrorDesc?(e.addDoorForm=!0,$("#doorNodeError").show(),$("#doorNodeError").text("Door Node already taken")):window&&console.log(o):($("#addDoorForm").modal("hide"),r(),n())}).error(function(e){window&&console.log(e)})}},e.addDevice=function(){var a="",r="",n="",i="";if("OS"==e.addDeviceType){r=e.tbOsDeviceName;var c=e.tbOsId1,l=e.tbOsId2,u=e.tbOsId3,m=e.tbOsId4,v=e.tbOsId5,f=e.tbOsId6;c&&l&&u&&m&&v&&f&&(a=e.tbOsId1+e.tbOsId2+e.tbOsId3+e.tbOsId4+e.tbOsId5+e.tbOsId6)}else if("VS"==e.addDeviceType){r=e.tbVsDeviceName;var h=e.tbVsId1,y=e.tbVsId2,E=e.tbVsId3,g=e.tbVsId4,b=e.tbVsId5,w=e.tbVsId6;h&&y&&E&&g&&b&&w&&(a=e.tbVsId1+e.tbVsId2+e.tbVsId3+e.tbVsId4+e.tbVsId5+e.tbVsId6),n=$("#ddlVsAddDoor").val()}else"CR"==e.addDeviceType?(r=e.tbRfidDeviceName,a=e.tbRfidDeviceId,n=$("#ddlRfidAddDoor").val(),i=$("#ddlRfidClocktype").val()):"PCR"==e.addDeviceType&&(r=e.tbRfidPinDeviceName,a=e.tbRfidPinDeviceId,n=$("#ddlRfidPinAddDoor").val(),i=$("#ddlRfidPinClocktype").val());var D=t.validateAlphaNumeric(a,!0),x=t.validateRequiredField(r);if(x?"OS"==e.addDeviceType?($("#deviceNameOsError").show(),$("#deviceNameOsError").text(x)):"VS"==e.addDeviceType?($("#deviceNameVsError").show(),$("#deviceNameVsError").text(x)):"CR"==e.addDeviceType?($("#deviceNameRfidError").show(),$("#deviceNameRfidError").text(x)):"PCR"==e.addDeviceType&&($("#deviceNameRfidPinError").show(),$("#deviceNameRfidPinError").text(x)):"OS"==e.addDeviceType?($("#deviceNameOsError").hide(),$("#deviceNameOsError").text("")):"VS"==e.addDeviceType?($("#deviceNameVsError").hide(),$("#deviceNameVsError").text("")):"CR"==e.addDeviceType?($("#deviceNameRfidError").hide(),$("#deviceNameRfidError").text("")):"PCR"==e.addDeviceType&&($("#deviceNameRfidPinError").hide(),$("#deviceNameRfidPinError").text("")),D)return void("OS"==e.addDeviceType?($("#deviceIdOsError").show(),$("#deviceIdOsError").text(D)):"VS"==e.addDeviceType?($("#deviceIdVsError").show(),$("#deviceIdVsError").text(D)):"CR"==e.addDeviceType?($("#deviceIdRfidError").show(),$("#deviceIdRfidError").text(D)):"PCR"==e.addDeviceType&&($("#deviceIdRfidPinError").show(),$("#deviceIdRfidPinError").text(D)));if("OS"==e.addDeviceType?($("#deviceIdOsError").hide(),$("#deviceIdOsError").text("")):"VS"==e.addDeviceType?($("#deviceIdVsError").hide(),$("#deviceIdVsError").text("")):"CR"==e.addDeviceType?($("#deviceIdRfidError").hide(),$("#deviceIdRfidError").text("")):"PCR"==e.addDeviceType&&($("#deviceIdRfidPinError").hide(),$("#deviceIdRfidPinError").text("")),("VS"==e.addDeviceType||"OS"==e.addDeviceType)&&a.length<12)return void("OS"==e.addDeviceType?($("#deviceIdOsError").show(),$("#deviceIdOsError").text("Invalid MAC Address")):"VS"==e.addDeviceType&&($("#deviceIdVsError").show(),$("#deviceIdVsError").text("Invalid MAC Address")));if("OS"==e.addDeviceType?($("#deviceIdOsError").hide(),$("#deviceIdOsError").text("")):"VS"==e.addDeviceType&&($("#deviceIdVsError").hide(),$("#deviceIdVsError").text("")),!(D&&x&&a.length<12)){e.addDeviceFormContent=!1,e.addingDevice=!0;var C=new Object;C.DeviceId=a,C.DeviceName=r,C.DeviceType=e.addDeviceType,i&&(C.Type3=i),o.post("/eyex-lite/controllers/device/addDevice.php",C).success(function(o){console.log(o),e.addingDevice=!1,o.Error?(window&&console.log(o),"DeviceId Exists"==o.ErrorDesc&&(e.addDeviceFormContent=!0,"VS"==e.addDeviceType?($("#deviceIdVsError").show(),$("#deviceIdVsError").text("Device Exists")):"OS"==e.addDeviceType?($("#deviceIdOsError").show(),$("#deviceIdOsError").text("Device Exists")):"CR"==e.addDeviceType?($("#deviceIdRfidError").show(),$("#deviceIdRfidError").text("Device Exists")):"PCR"==e.addDeviceType&&($("#deviceIdRfidPinError").show(),$("#deviceIdRfidPinError").text("Device Exists")))):n?p(a,n,function(){$("#addDeviceForm").modal("hide"),s(),d()}):($("#addDeviceForm").modal("hide"),s(),d())}).error(function(e){window&&console.log(e)})}},e.forceOpenDoor=function(){e.editDoorFormControls=!1,e.openingDoor=!0;var t=new Object;t.DoorNode=e.editDoorNode,o.post("/eyex-lite/controllers/door/doorSystemOverride.php",t).success(function(o){e.openingDoor=!1,e.editDoorFormControls=!0,o.Error?window&&console.log(o):window&&console.log(o)}).error(function(e){window&&console.log(e)})},e.addDevicePopup=function(){d(),i(),$("#addDeviceForm").modal({keyboard:!1,backdrop:"static"})},e.addDoorPopup=function(){n(),$("#addDoorForm").modal({keyboard:!1,backdrop:"static"})},e.closeAddDoorPopup=function(){$("#addDoorForm").modal("hide")},e.closeAddDevicePopup=function(){$("#addDeviceForm").modal("hide")},e.closeEditDevicePopup=function(){$("#editDeviceForm").modal("hide")},e.closeEditDoorPopup=function(){$("#editDoorForm").modal("hide")},s()}]),angular.module("eyexApp.doorAccessController",[]).controller("doorAccessController",["$scope","$http","validationServices",function(e,o,t){var a=function(e){o.get("/OfficeStation/reloadFeaturesCode.php").success(function(){e()}).error(function(o){console.log(o),e()})},r=function(){$("#loadDoorAccess").modal({keyboard:!1,backdrop:"static"}),o.get("/eyex-lite/controllers/features/getFeatures.php").success(function(o){if($("#loadDoorAccess").modal("hide"),console.log(o),o.RowsReturned>0){e.featuresId=o.Data[0].id;var t,a,r,n,i=o.Data[0].remote_door,c=o.Data[0].local_door;if(i){var d=i.toString().split("");d[0]?(t=d[0],e.tbRemote1=t):e.tbRemote1="",d[1]?(a=d[1],e.tbRemote2=a):e.tbRemote2="",d[2]?(r=d[2],e.tbRemote3=r):e.tbRemote3="",d[3]?(n=d[3],e.tbRemote4=n):e.tbRemote4=""}var s,l,u,m;if(c){var p=c.toString().split("");p[0]?(s=p[0],e.tbLocal1=s):e.tbLocal1="",p[1]?(l=p[1],e.tbLocal2=l):e.tbLocal2="",p[2]?(u=p[2],e.tbLocal3=u):e.tbLocal3="",p[3]?(m=p[3],e.tbLocal4=m):e.tbLocal4=""}}})};e.editDoorAccess=function(){var n=e.tbRemote1,i=e.tbRemote2,c=e.tbRemote3,d=e.tbRemote4,s=e.tbLocal1,l=e.tbLocal2,u=e.tbLocal3,m=e.tbLocal4,p="";n&&(p+=String(n)),i&&(p+=String(i)),c&&(p+=String(c)),d&&(p+=String(d));var v="";s&&(v+=String(s)),l&&(v+=String(l)),u&&(v+=String(u)),m&&(v+=String(m));var f=t.validateRequiredInteger(p,null),h=t.validateRequiredInteger(v,null);if(f?(e.remoteError=!0,e.valRemote=f):(e.valRemote="",e.remoteError=!1),h?(e.localError=!0,e.valLocal=h):(e.valLocal="",e.localError=!1),!f&&!h){$("#editingDoorAccessSettings").modal({keyboard:!1,backdrop:"static"});var y=new Object;y.RemoteDoor=p,y.LocalDoor=v,e.featuresId?(y.FeaturesId=e.featuresId,o.post("/eyex-lite/controllers/features/updateFeatures.php",y).success(function(e){$("#editingDoorAccessSettings").modal("hide"),console.log(e),a(function(){r()})}).error(function(e){window&&console.log(e)})):o.post("/eyex-lite/controllers/features/addFeatures.php",y).success(function(e){$("#editingDoorAccessSettings").modal("hide"),console.log(e),a(function(){r()})}).error(function(e){window&&console.log(e)})}},r()}]),angular.module("eyexApp.editCompanyProfileController",[]).controller("editCompanyProfileController",["$scope","$http","$rootScope","validationServices",function(e,o,t,a){$("#uploadCompanyLogoForm").attr("action","/eyex-lite/controllers/company/uploadCompanyLogo.php"),$("#coLogoUpload").on("change",function(){$("#coLogoUpload").val()&&n()}),e.workStart=moment({hour:8}),e.workEnd=moment({hour:17});var r=function(){$("#loadCompanyProfile").modal({backdrop:"static",keyboard:!1});var t="?AuthorizationLevel=400";o.get("/eyex-lite/controllers/users/getUserDetails.php"+encodeURI(t)).success(function(o){if($("#loadCompanyProfile").modal("hide"),console.log(o.Data),o.Error)window&&console.log(o.ErrorDesc);else{var t=o.Data[0];if(e.companyId=t.id,e.tbCompanyName=t.name,t.apartment&&(e.tbBlk=t.apartment),t.street_1&&(e.tbRoad=t.street_1),t.suite){var a=t.suite.substring(0,t.suite.indexOf("-")),r=t.suite.substring(t.suite.indexOf("-")+1);e.tbUnit1=a,e.tbUnit2=r}if(t.postcode&&(e.tbZip=t.postcode),t.country&&$("#ddlCountry").val(t.country),t.extra_data2&&t.extra_data3&&($("#ddlWebsiteProtocol").val(t.extra_data2),e.tbWebsite=t.extra_data3),t.extra_data){var n=t.extra_data.split(",");console.log(n);for(var i=0;i<n.length;i++)"1"==n[i]?$("#cbMon").prop("checked","checked"):"2"==n[i]?$("#cbTue").prop("checked","checked"):"3"==n[i]?$("#cbWed").prop("checked","checked"):"4"==n[i]?$("#cbThu").prop("checked","checked"):"5"==n[i]?$("#cbFri").prop("checked","checked"):"6"==n[i]?$("#cbSat").prop("checked","checked"):"7"==n[i]&&$("#cbSun").prop("checked","checked")}"0000-00-00 00:00:00"!=t.extra_date_time&&(e.workStart=moment(moment(moment(t.extra_date_time).format("YYYY-MM-DDTHH:mm:ss+0000")).format("LLLL"))),"0000-00-00 00:00:00"!=t.extra_date_time2&&(e.workEnd=moment(moment(moment(t.extra_date_time2).format("YYYY-MM-DDTHH:mm:ss+0000")).format("LLLL"))),_user_img&&($("#showNoCompanyLogo").hide(),$("#showCompanyLogo").show(),$("#imgCoLogo").prop("src",_user_img),$("#removeCompanyLogo").css("display","inline-block"))}})};e.saveCompanyDetails=function(){var t=e.tbCompanyName,n=e.tbWebsite,i=$("#ddlCountry").val(),c=$("#ddlWebsiteProtocol").val(),d="",s="",l="",u="";e.tbBlk&&(d=e.tbBlk),e.tbRoad&&(s=e.tbRoad),e.tbUnit1&&e.tbUnit2&&(l=e.tbUnit1+"-"+e.tbUnit2),e.tbZip&&(u=e.tbZip);var m=a.validateRequiredField(t);m?(e.companyNameError=!0,e.valCompanyName=m):(e.valCompanyName="",e.companyNameError=!1);var p=!1,v=!1;if(n&&(p=a.validateRequiredField(c,"Select Protocol"),v=a.validateRequiredUrl(n,!1)),v||p?(e.websiteError=!0,v&&(e.valWebsite=v),p&&(e.valWebsite=p)):(e.valWebsite="",e.websiteError=!1),!(m||p||v)){$("#updateCompanyProfile").modal({backdrop:"static",keyboard:!1});var f=e.workStart,h=e.workEnd,y="";$("#cbMon").is(":checked")&&(y+="1,"),$("#cbTue").is(":checked")&&(y+="2,"),$("#cbWed").is(":checked")&&(y+="3,"),$("#cbThu").is(":checked")&&(y+="4,"),$("#cbFri").is(":checked")&&(y+="5,"),$("#cbSat").is(":checked")&&(y+="6,"),$("#cbSun").is(":checked")&&(y+="7,");var E=y.lastIndexOf(","),g=y.slice(0,E),b=new Object;b.Name=t,b.UserId=e.companyId,b.Apartment=d,b.Street1=s,b.Suite=l,b.Postcode=u,b.Country=i,b.ExtraData=g,b.ExtraDateTime=f,b.ExtraDateTime2=h,b.ExtraData2=c,b.ExtraData3=n,console.log(b),o.post("/eyex-lite/controllers/users/updateUser.php",b).success(function(e){$("#updateCompanyProfile").modal("hide"),e.Error?window&&console.log(e.ErrorDesc):(window&&console.log(e),$("#updateCompanyProfile").modal("hide"),r())}).error(function(e){window&&console.log(e)})}},e.removeCompanyLogo=function(){$("#companyLogoError").hide(),$("#removeCompanyLogo").hide(),$("#showUploadingCompanyLogo").show(),$("#showCompanyLogo").hide(),$("#imgCoLogo").attr("src",""),o.post("/eyex-lite/controllers/company/removeCompanyLogo.php").success(function(o){o.Error?window&&console.log(o.ErrorDesc):($("#showUploadingCompanyLogo").hide(),$("#showNoCompanyLogo").show(),$("#uploadCompanyLogoForm").get(0).reset(),e.logoId="",window&&console.log(o))}).error(function(e){window&&console.log(e)})};var n=function(){return $("#companyLogoError").hide(),$("#showCompanyLogo").hide(),$("#showNoCompanyLogo").hide(),$("#showUploadingCompanyLogo").show(),$("#removeCompanyLogo").hide(),$("#uploadCompanyLogoForm").ajaxSubmit({error:function(){$("#showUploadingCompanyLogo").hide(),e.logoId?$("#showCompanyLogo").show():$("#showNoCompanyLogo").show()},success:function(e){console.log(e);var o=JSON.parse(e);if(o.Error)$("#companyLogoError").text(o.ErrorDesc),$("#companyLogoError").show(),_user_img?$("#showCompanyLogo").show():$("#showNoCompanyLogo").hide(),$("#showUploadingCompanyLogo").hide(),$("#removeCompanyLogo").css("display","inline-block");else{var t="../../../doorphpscript/comp_logo/"+o.Data[0].file_name;_user_img=t,$("#showUploadingCompanyLogo").hide(),$("#showCompanyLogo").show(),$("#imgCoLogo").attr("src",t),$("#uploadCompanyLogoForm").get(0).reset(),$("#removeCompanyLogo").css("display","inline-block")}}}),!1};r()}]),angular.module("eyexApp.editProfileController",[]).controller("editProfileController",["$scope","$http","$rootScope","validationServices",function(e,o,t,a){$("#uploadProfilePicForm").attr("action","/eyex-lite/controllers/employees/uploadUserProfilePicture.php?UserId="+_user_id),$("#profilePicUpload").on("change",function(){$("#profilePicUpload").val()&&n()}),$("#tbFirstName").focus();var r=function(){$("#loadingProfile").modal({backdrop:"static",keyboard:!1});var t="?UserId="+_user_id;o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(t)).success(function(o){$("#loadingProfile").modal("hide"),console.log(o.Data);var t=o.Data[0];if(e.tbFirstName=t.first_name,e.tbLastName=t.last_name,t.apartment&&(e.tbBlk=t.apartment),t.street_1&&(e.tbRoad=t.street_1),t.suite){var a=t.suite.substring(0,t.suite.indexOf("-")),r=t.suite.substring(t.suite.indexOf("-")+1);e.tbUnit1=a,e.tbUnit2=r}t.postcode&&(e.tbZip=t.postcode),t.country&&$("#ddlCountry").val(t.country),_user_img&&($("#showNoProfilePicture").hide(),$("#showProfilePicture").show(),$("#imgProfilePicture").prop("src",_user_img),$("#removeProfilePic").css("display","inline-block"))})};e.editProfile=function(){var t=e.tbFirstName,n=e.tbLastName,i=$("#ddlCountry").val(),c="",d="",s="",l="";e.tbBlk&&(c=e.tbBlk),e.tbRoad&&(d=e.tbRoad),e.tbUnit1&&e.tbUnit2&&(s=e.tbUnit1+"-"+e.tbUnit2),e.tbZip&&(l=e.tbZip);var u=a.validateRequiredField(t),m=a.validateRequiredField(n);if(u?(e.firstNameError=!0,e.valFirstName=u):(e.valFirstName="",e.firstNameError=!1),m?(e.lastNameError=!0,e.valLastName=m):(e.valLastName="",e.lastNameError=!1),!u||!m){$("#updatingProfile").modal({backdrop:"static",keyboard:!1});var p=new Object;p.UserId=_user_id,p.FirstName=t,p.LastName=n,p.Apartment=c,p.RoadName=d,p.Country=i,p.Suite=s,p.Zip=l,console.log(p),o.post("/eyex-lite/controllers/users/updateUser.php",p).success(function(e){$("#updatingProfile").modal("hide"),r(),e.Error?window&&console.log(e.ErrorDesc):window&&console.log(e)}).error(function(e){window&&console.log(e)})}};var n=function(){return $("#profilePicError").hide(),$("#showProfilePicture").hide(),$("#showNoProfilePicture").hide(),$("#showUploadingProfilePicture").show(),$("#removeProfilePic").hide(),$("#uploadProfilePicForm").ajaxSubmit({error:function(){$("#showUploadingProfilePicture").hide(),e.logoId?$("#showProfilePicture").show():$("#showNoProfilePicture").show()},success:function(e){console.log(e);var o=JSON.parse(e);if(o.Error)$("#profilePicError").text(o.ErrorDesc),$("#profilePicError").show(),$("#showUploadingProfilePicture").hide(),$("#removeProfilePic").css("display","inline-block"),_user_img?$("#showProfilePicture").show():$("#showNoProfilePicture").show();else{var t="../../../data/"+_user_id+"/"+o.Data[0].file_name;_user_img=t,$("#showUploadingProfilePicture").hide(),$("#showProfilePicture").show(),$("#imgProfilePicture").attr("src",t),$("#uploadProfilePicForm").get(0).reset(),$("#removeProfilePic").css("display","inline-block")}}}),!1};e.removeProfilePicture=function(){$("#profilePicError").hide(),$("#removeProfilePic").hide(),$("#showUploadingProfilePicture").show(),$("#showProfilePicture").hide(),$("#imgProfilePicture").attr("src","");var e=new Object;e.UserId=_user_id,o.post("/eyex-lite/controllers/employees/removeUserProfilePicture.php",e).success(function(e){e.Error?window&&console.log(e.ErrorDesc):($("#showUploadingProfilePicture").hide(),$("#showNoProfilePicture").show(),$("#uploadProfilePicForm").get(0).reset(),$("#uploadProfilePicForm").attr("action","/eyex-lite/controllers/employees/uploadUserProfilePicture.php?UserId="+_user_id),window&&console.log(e))}).error(function(e){window&&console.log(e)})},r()}]),angular.module("eyexApp.employeesController",[]).controller("employeesController",["$scope","$http","countryServices","validationServices","eyexServices",function(e,o,t,a,r){e.employeeForm=!0;for(var n=t.getCountries(),i=0;i<n.length;i++){var c='<option value="'+n[i].code+'">'+n[i].name+" (+"+n[i].code+")</option>";$("#ddlEditCountryCode").append(c),$("#ddlEditCountryCode2").append(c),$("#ddlCountryCode").append(c),$("#ddlCountryCode2").append(c)}var d=function(){$("#loadEmployeesModal").modal({backdrop:"static",keyboard:!1});var t="?Type=contact";o.get("/eyex-lite/controllers/users/getUserDetails.php"+encodeURI(t)).success(function(o){console.log(o.Data),e.employees=o.Data,$("#loadEmployeesModal").modal("hide")})},s=function(){e.employeeForm=!0,e.addingEmployee=!1,e.employeeAdded=!1,e.addEmployeeOverallError=!1,e.firstNameError=!1,e.lastNameError=!1,e.emailError=!1,e.pinError=!1,e.phoneNumberError=!1,e.phoneNumber2Error=!1,e.cardIdError=!1,e.passwordError=!1,e.tbFirstName="",e.tbLastName="",e.tbEmail="",e.tbPin="",e.tbPhone="",e.tbPhone2="",e.tbPassword="",e.tbCardId="",$("#ddlCountryCode").val(""),$("#ddlCountryCode2").val("")},l=function(){e.editEmployeeForm=!0,e.editingEmployeeDetail=!1,e.confirmDeleteEmployee=!1,e.deletingEmployee=!1,e.archivingEmployee=!1,e.editEmployeeOverallError=!1,e.editFirstNameError=!1,e.editLastNameError=!1,e.editPinError=!1,e.editCardIdError=!1,e.editPasswordError=!1,e.editUserTypeError=!1,e.editPhoneNumberError=!1,e.editPhoneNumber2Error=!1,e.tbEditFirstName="",e.tbEditLastName="",e.tbEditPin="",e.tbEditPhone="",e.tbEditPhone2="",e.tbEditPassword="",$("#ddlEditUserType").val(300),$("#ddlEditCountryCode").val(""),$("#ddlEditCountryCode2").val("")};e.addEmployeePopup=function(){s(),$("#addEmployeeModal").modal({backdrop:"static",keyboard:!1}),$("#addEmployeeModal").on("shown.bs.modal",function(){$("#tbFirstName").focus()})},e.editEmployeePopup=function(t){l(),e.editEmployeeForm=!1,e.loadingEditEmployeeDetail=!0,$("#tbEditFirstName").focus(),$("#editEmployeeModal").modal({backdrop:"static",keyboard:!1}),$("#editEmployeeModal").on("shown.bs.modal",function(){$("#tbEditFirstName").focus()});var a="?UserId="+t;a+="&Type=contact",o.get("/eyex-lite/controllers/users/getUserDetails.php"+encodeURI(a)).success(function(o){if(o.RowsReturned>0){var a=o.Data[0];e.loadingEditEmployeeDetail=!1,e.editEmployeeForm=!0,$("#ddlEditCountryCode").val(a.sip_cc),$("#ddlEditCountryCode2").val(a.sip2_cc),e.tbEditPhone=a.sip,e.tbEditPhone2=a.sip2,e.tbEditFirstName=a.first_name,e.tbEditLastName=a.last_name,e.tbEditEmail=a.username,e.tbEditCardId=a.card_id,$("#ddlEditUserType").val(a.authorization_level),e.editUserId=t}})},e.addEmployee=function(){var t=e.tbFirstName,r=e.tbLastName,n=e.tbEmail,i=e.tbPassword,c=e.tbPin,s=e.tbCardId,l=$("#ddlCountryCode").val(),u=e.tbPhone,m=$("#ddlCountryCode2").val(),p=e.tbPhone2,v=a.validateRequiredField(t),f=a.validateRequiredField(r),h=a.validateEmail(n,!0),y=a.validateRequiredLength(c,!1,null,4,"PIN needs to be at least 4 characters long"),E=a.validateRequiredLength(i,!0,null,8,null),g=a.validateRequiredInteger(c,!1,null,"PIN needs to be numeric");v?(e.firstNameError=!0,e.valFirstName=v):(e.valFirstName="",e.firstNameError=!1),f?(e.lastNameError=!0,e.valLastName=f):(e.valLastName="",e.lastNameError=!1),h?(e.emailError=!0,e.valEmail=h):(e.valEmail="",e.emailError=!1),E?(e.passwordError=!0,e.valPassword=E):(e.valPassword="",e.passwordError=!1),y||g?(e.pinError=!0,y?e.valPin=y:g&&(e.valPin=g)):(e.valPin="",e.pinError=!1);var b=!1,w=!1;u&&(b=a.validateRequiredField(l,"Select Country Code"),w=a.validateRequiredInteger(u,!0,null,"Invalid Phone Number"),w||b?(e.phoneNumberError=!0,w&&(e.valPhoneNumber=w),b&&(e.valPhoneNumber=b)):(e.valPhoneNumber="",e.phoneNumberError=!1));var D=!1,x=!1;if(p){var D=a.validateRequiredField(m,"Select Country Code"),x=a.validateRequiredInteger(p,!0,null,"Invalid Phone Number");x||D?(e.phoneNumber2Error=!0,x&&(e.valPhoneNumber2=x),D&&(e.valPhoneNumber2=D)):(e.valPhoneNumber2="",e.phoneNumber2Error=!1)}if(v||f||h||y||g||E||w||x||D||b);else{var C=new Object;C.FirstName=t,C.LastName=r,C.Name=r+" "+t,C.Status="A",C.Username=n,C.Password=i,C.AuthorizationLevel=300,C.Type="contact",s&&(C.CardId=s),c&&(C.PinNo=c),u&&(C.Sip=u,C.SipCc=l),p&&(C.Sip2=p,C.SipCc2=m),e.employeeForm=!1,e.addingEmployee=!0,o.post("/eyex-lite/controllers/users/addEmployee.php",C).success(function(o){console.log(o),o.Error?(e.addingEmployee=!1,e.employeeForm=!0,"PIN In Use"==o.ErrorDesc?(e.pinError=!0,e.valPin="PIN already taken"):"Card ID In Use"==o.ErrorDesc?(e.cardIdError=!0,e.valCardId="Card ID already taken"):"User Exists"==o.ErrorDesc?(e.emailError=!0,e.valEmail="User email taken"):(e.addEmployeeOverallError=!0,e.valAddEmployee=o.ErrorDesc,window&&console.log(o.ErrorDesc))):($("#addEmployeeModal").modal("hide"),d())}).error(function(e){window&&console.log(e)})}},e.editEmployee=function(){var t=e.tbEditFirstName,r=e.tbEditLastName,n=$("#ddlEditCountryCode").val(),i=e.tbEditPhone,c=$("#ddlEditCountryCode2").val(),s=e.tbEditPhone2,l=e.tbEditPassword,u=e.tbEditPin,m=e.tbEditCardId,p=a.validateRequiredField(t),v=a.validateRequiredField(r),f=a.validateRequiredLength(u,!1,null,4,"PIN needs to be at least 4 characters long"),h=a.validateRequiredInteger(u,!1,null,"PIN needs to be numeric"),y=a.validateRequiredLength(l,!1,null,8,null);p?(e.editFirstNameError=!0,e.valEditFirstName=p):(e.valEditFirstName="",e.editFirstNameError=!1),v?(e.editLastNameError=!0,e.valEditLastName=v):(e.valEditLastName="",e.editLastNameError=!1),y?(e.editPasswordError=!0,e.valEditPassword=y):(e.valEditPassword="",e.editPasswordError=!1),f||h?(e.editPinError=!0,f?e.valEditPin=f:h&&(e.valEditPin=h)):(e.valEditPin="",e.editPinError=!1);var E=!1,g=!1;i&&(E=a.validateRequiredField(n,"Select Country Code"),g=a.validateRequiredInteger(i,!0,null,"Invalid Phone Number"),g||E?(e.editPhoneNumberError=!0,g&&(e.valEditPhoneNumber=g),E&&(e.valEditPhoneNumber=E)):(e.valEditPhoneNumber="",e.editPhoneNumberError=!1));var b=!1,w=!1;if(s){var b=a.validateRequiredField(c,"Select Country Code"),w=a.validateRequiredInteger(s,!0,null,"Invalid Phone Number");w||b?(e.editPhoneNumber2Error=!0,w&&(e.valEditPhoneNumber2=w),b&&(e.valEditPhoneNumber2=b)):(e.valEditPhoneNumber2="",e.editPhoneNumber2Error=!1)}if(p||v||g||w||b||E||y||f||h);else{e.editingEmployeeDetail=!0,e.editEmployeeForm=!1;var D=new Object;D.UserId=e.editUserId,D.FirstName=t,D.LastName=r,D.Name=r+" "+t,l&&(D.Password=l),u&&(D.PinNo=u),m&&(D.CardId=m),i?(D.Sip=i,D.SipCc=n):(D.Sip="",D.SipCc=""),s?(D.Sip2=s,D.SipCc2=c):(D.Sip2="",D.SipCc2=""),o.post("/eyex-lite/controllers/users/updateEmployee.php",D).success(function(o){console.log(o),o.Error?(e.editingEmployeeDetail=!1,e.editEmployeeForm=!0,"PIN In Use"==o.ErrorDesc?(e.editPinError=!0,e.valEditPin="PIN already taken"):"You are using this PIN"==o.ErrorDesc?(e.editPinError=!0,e.valEditPin=o.ErrorDesc):"Card ID In Use"==o.ErrorDesc?(e.editCardIdError=!0,e.valEditCardId="Card ID already taken"):(e.editEmployeeOverallError=!0,e.valEditEmployee=o.ErrorDesc),window&&console.log(o.ErrorDesc)):(e.valEditEmployee="",e.editEmployeeOverallError=!1,e.editingEmployeeDetail=!1,$("#editEmployeeModal").modal("hide"),d())}).error(function(e){window&&console.log(e)})}},e.deleteEmployee=function(){e.editEmployeeForm=!1,e.confirmDeleteEmployee=!0},e.cancelDeleteEmployee=function(){e.editEmployeeForm=!0,e.confirmDeleteEmployee=!1},e.deleteEmployeeConfirmed=function(){var t=new Object;t.EmployeeId=e.editUserId,e.confirmDeleteEmployee=!1,e.deletingEmployee=!0,o.post("/eyex-lite/controllers/users/deleteEmployee.php",t).success(function(o){console.log(o),e.deletingEmployee=!1,$("#editEmployeeModal").modal("hide"),d()}).error(function(e){window&&console.log(e)})},e.archiveEmployeeConfirmed=function(){var t=new Object;t.EmployeeId=e.editUserId,e.confirmDeleteEmployee=!1,e.archivingEmployee=!0,o.post("/eyex-lite/controllers/users/archiveEmployee.php",t).success(function(o){console.log(o),e.archivingEmployee=!1,$("#editEmployeeModal").modal("hide"),d()}).error(function(e){window&&console.log(e)})},e.cancelAddEmployee=function(){s(),$("#addEmployeeModal").modal("hide")},e.cancelEditEmployee=function(){l(),$("#editEmployeeModal").modal("hide")},e.syncEmployees=function(){$("#syncingEmployees").modal({backdrop:"static",keyboard:!1}),r.deviceBroadcast(function(e){$("#syncingEmployees").modal("hide"),console.log(e)})},e.editAuthorizationPopup=function(t,a){e.editEmployeeAuthorizationForm=!0,$("#editAuthorizationModal").modal({backdrop:"static",keyboard:!1}),e.authorizationName=a+"'s";var r="?EmployeeId="+t;o.get("/eyex-lite/controllers/device/getDeviceEmployeeAuthentication.php"+encodeURI(r)).success(function(o){console.log(o.Data),e.employeeDeviceAuthentications=o.Data,e.editAuthorizationEmployeeId=t})},e.editAuthorization=function(){e.editEmployeeAuthorizationForm=!1,e.editingAuthorization=!0;var t=new Array;$(".device-authorized").each(function(){if($(this).is(":checked")){var e=$(this).val();t.push(e)}});var a=JSON.stringify(t),r=new Object;r.EmployeeId=e.editAuthorizationEmployeeId,r.DeviceIds=a,o.post("/eyex-lite/controllers/deviceRelationship/assignEmployeeDeviceAuth.php",r).success(function(o){e.editingAuthorization=!1,o.Error?window&&console.log(o):$("#editAuthorizationModal").modal("hide")}).error(function(e){window&&console.log(e)})},e.cancelEditAuthorizationLevel=function(){$("#editAuthorizationModal").modal("hide")},d()}]),angular.module("eyexApp.extensionsController",[]).controller("extensionsController",["$scope","$http","$rootScope","validationServices","eyexServices",function(e,o,t,a,r){var n=new Array,i=new Array,c=function(){$("#ddlAddAssignTo").html('<option value="">Select Employee</option>'),$("#ddlEditAssignedTo").html('<option value="">Select Employee</option>');var e="?Type=contact";o.get("/eyex-lite/controllers/users/getUserDetails.php"+encodeURI(e)).success(function(e){for(var o=0;o<e.RowsReturned;o++)if(!e.Data[o].extension_number){var t=new Object,a='<option value="'+e.Data[o].id+'">'+e.Data[o].name+"</option>";t.name=e.Data[o].name,t.entity_id=e.Data[o].id,n.push(t),$("#ddlEditAssignedTo").append(a),$("#ddlAddAssignTo").append(a)}$("#ddlAddAynsignTo").val(""),$("#ddlEditAssignedTo").val("")})},d=function(){$("#addExtensionModal").modal("hide"),e.addingExtension=!1,e.addExtensionForm=!1,e.tbExtensionNumber="",e.tbExtensionPassword="",e.tbConfirmExtensionPassword="",e.extensionNumberError=!1,e.extensionPasswordError=!1,e.extensionConfirmPasswordError=!1,c()},s=function(){$("#editExtensionModal").modal("hide"),e.editExtensionForm=!1,e.deletingExtension=!1,e.deleteExtensionConfirmForm=!1,e.editingExtension=!1,c()},l=function(){$("#loadExtensions").modal({backdrop:"static",keyboard:!1}),o.get("/eyex-lite/controllers/extensions/getExtensionDetail.php").success(function(o){$("#loadExtensions").modal("hide"),e.extensions=o.Data,i=new Array;for(var t=0;t<o.RowsReturned;t++)i.push(o.Data[t].extension_number)})};e.addExtensionPopup=function(){$("#addExtensionModal").modal({backdrop:"static",keyboard:!1}),e.addExtensionForm=!0},e.editExtensionPopup=function(o,t,a,r,n){$("#editExtensionModal").modal({backdrop:"static",keyboard:!1}),e.editExtensionForm=!0,e.editExtensionId=a,e.editExtensionNumber=o,e.editAssignedId=t,e.editExtensionProfilePic=n,t?(e.assignedExt=!0,e.notAssignedExt=!1,n?($("#editExtImgUrl").removeAttr("src"),$("#editExtImgUrl").css("background-image","url("+n+")")):$("#editExtImgUrl").prop("src","/eyex-lite/public/img/avartar-xs.png"),$("#ddlEditAssignedTo").append('<option value="'+t+'">'+r+"</option>")):(e.notAssignedExt=!0,e.assignedExt=!1)},e.syncExtensions=function(){$("#syncingExtensions").modal({backdrop:"static",keyboard:!1}),r.deviceBroadcast(function(){$("#syncingExtensions").modal("hide")})},e.editExtension=function(){var t=$("#ddlEditAssignedTo").val(),a=new Object;e.editExtensionForm=!1,e.editingExtension=!0,a.ExtensionId=e.editExtensionId,a.UserId=t,console.log(a),o.post("/eyex-lite/controllers/extensions/updateExtension.php",a).success(function(o){console.log(o),o.Error?(e.editingExtension=!1,e.editExtensionForm=!0,window&&console.log(o.ErrorDesc)):(s(),l())}).error(function(e){window&&console.log(e)})},e.addExtension=function(){var t=e.tbExtensionNumber,r=e.tbExtensionPassword,n=e.tbConfirmExtensionPassword,c=e.tbVoicemailPassword,s=$("#ddlAddAssignTo").val(),u=a.validateRequiredInteger(t,!0,null,"Extension number needs to be numeric"),m=a.validateRequiredLength(r,!0,null,6,null),p=a.validateRequiredSimilarField(n,!0,null,r,"Passwords does not match");if(u||i.indexOf(parseInt(t))>=0?(u&&(e.extensionNumberError=!0,e.valExtensionNumber=u),i.indexOf(parseInt(t))>=0&&(e.extensionNumberError=!0,e.valExtensionNumber="Extension is already added")):(e.valExtensionNumber="",e.extensionNumberError=!1),m?(e.extensionPasswordError=!0,e.valExtensionPassword=m):(e.valExtensionPassword="",e.extensionPasswordError=!1),p?(e.extensionConfirmPasswordError=!0,e.valExtensionConfirmPassword=p):(e.valExtensionConfirmPassword="",e.extensionConfirmPasswordError=!1),u||m||p);else{var v=new Object;v.ExtensionNumber=t,v.Password=r,c&&(v.VoicemailPassword=c),s&&(v.UserId=s),e.addExtensionForm=!1,e.addingExtension=!0,o.post("/eyex-lite/controllers/extensions/addExtension.php",v).success(function(o){o.Error?(e.addingExtension=!1,e.addExtensionForm=!0,e.overallError=!0,e.valAddExtension=o.ErrorDesc,window&&console.log(o.ErrorDesc)):(e.valAddExtension="",e.overallError=!1,d(),l())}).error(function(e){window&&console.log(e)})}},e.deleteExtensionConfirm=function(){e.editExtensionForm=!1,e.deleteExtensionConfirmForm=!0,e.editExtensionAssignedId?(e.ifConfirmDelete=!0,e.ifNotAssignedConfirmDelete=!1):(e.ifNotAssignedConfirmDelete=!0,e.ifConfirmDelete=!1)},e.cancelDeleteExtension=function(){e.deleteExtensionConfirmForm=!1,e.editExtensionForm=!0},e.deleteExtension=function(){e.deletingExtension=!0,e.deleteExtensionConfirmForm=!1;var t=new Object;t.ExtensionId=e.editExtensionId,o.post("/eyex-lite/controllers/extensions/deleteExtension.php",t).success(function(e){console.log(e),e.Error?window&&console.log(e.ErrorDesc):(s(),l())}).error(function(e){window&&console.log(e)})},e.cancelAddExtension=function(){$("#addExtensionModal").modal("hide"),d()},e.cancelEditExtension=function(){$("#editExtensionModal").modal("hide"),s()},c(),l()}]),angular.module("eyexApp.galleryController",[]).controller("galleryController",["$scope","$http","pageServices",function(e,o){var t="";e.popupImage=function(e,o){$("#loadImage").modal(),$("#imagePopupFrame").prop("src",e),$("#imageTitle").html(o?o:"Image")},e.closeImage=function(){$("#loadImage").modal("hide")};var a=function(){o.get("/eyex-lite/controllers/gallery/getSDCardImages.php").success(function(o){if(o.RowsReturned>0){t=o.Data;for(var a=0;a<t.length;a++){var r=t[a].year,n=t[a].month-1,i=t[a].day,c=t[a].hour,d=t[a].min,s=t[a].seconds;o.Data[a].full_date=moment({year:r,month:n,day:i,hour:c,minute:d,second:s}).format("D MMM YYYY, h:mm a")
}console.log(t),e.galleryExists=!0,e.pictures=o.Data}else e.galleryNoExists=!0})};a()}]),angular.module("eyexApp.indexController",[]).controller("indexController",["$scope","$http","validationServices",function(e,o,t){$("#tbEmail").focus();var a=new Object,r=new Object;r.type="sync-announcements",r.ownerId="V0L2XLKE-NMSZVA1K-YMQT23HJ",a.Data=JSON.stringify(r),o.post("/eyex-lite/controllers/sync/syncRemoteToLocal.php",a).success(function(e){console.log(e)}).error(function(e){console.log(e)}),e.login=function(){var a=e.tbEmail,r=e.tbPassword,n=t.validateRequiredField(r),i=t.validateEmail(a,!0);if(i?(e.emailError=!0,e.valEmail=i):(e.valEmail="",e.emailError=!1),n?(e.passwordError=!0,e.valPassword=n):(e.valPassword="",e.passwordError=!1),n||i)return e.overallError=!0,void(e.valOverallError="Fill up required fields!");e.overallError=!1,e.valOverallError="";var c=new Object;c.Email=a,c.Password=r,$("input").each(function(){$(this).blur()}),$("#loginModal").modal({backdrop:"static",keyboard:!1});var c=new Object;c.AuthenticationString=a,c.Password=r,o.post("/eyex-lite/controllers/account/login.php",c).success(function(o){if(console.log(o),o.RowsReturned>0){var t=o.Data[0],a=(t.username,parseInt(t.authorization_level));300==a?window.location="/eyex-lite/profile.php":a>=400&&(window.location="/eyex-lite/company.php")}else e.overallError=!0,e.valOverallError="Authentication Failed",$("#loginModal").modal("hide")}).error(function(e){$("#loginModal").modal("hide"),window&&console.log(e)})}}]),angular.module("eyexApp.ivrsController",[]).controller("ivrsController",["$scope","$http",function(){}]),angular.module("eyexApp.personalExtensionController",[]).controller("personalExtensionController",["$scope","$http","$rootScope","validationServices","eyexServices",function(e,o,t,a){var r=function(){$("#loadExtension").modal({backdrop:"static",keyboard:!1});var t="?UserId="+_user_id;o.get("/eyex-lite/controllers/extensions/getExtensions.php"+encodeURI(t)).success(function(o){if($("#loadExtension").modal("hide"),console.log(o.Data),!o.Error&&o.RowsReturned>0){var t=o.Data[0];e.tbExtensionNumber=t.extension_number,e.extensionId=t.id}else window&&console.log(o.ErrorDesc)})},n=function(){e.tbVoicemailPassword="",e.voicemailPasswordError=!1};r(),$("#tbVoicemailPassword").focus(),e.editExtension=function(){var t=e.tbVoicemailPassword,r=a.validateRequiredLength(t,!0,null,6);if(r?(e.voicemailPasswordError=!0,e.valVoicemailPassword=r):(e.voicemailPasswordError="",e.valVoicemailPassword=!1),r);else{$("#editingExtension").modal({backdrop:"static",keyboard:!1}),$("input").blur();var i=new Object;i.ExtensionId=e.extensionId,i.VoicemailPassword=t,console.log(i),o.post("/eyex-lite/controllers/extensions/updateExtension.php",i).success(function(o){$("#editingExtension").modal("hide"),console.log(o),o.Error?window&&console.log(o.ErrorDesc):(e.updateSuccess=!0,e.successMessage="Extension details updated",e.overallError=!1,e.valError="",n())}).error(function(e){window&&console.log(e)})}}}]),angular.module("eyexApp.profileController",[]).controller("profileController",["$scope","$http","dateTimeServices","statisticsServices","stringServices",function(e,o,t,a,r){e.clockInLoaded=!1,e.clockOutLoaded=!1,e.clockInExist=!1,e.clockOutExist=!1,e.clockOutCount=0,e.usuallyDoesntClockOut=!1;var n=function(){e.clockedHoursNoExist=!0},i=function(){e.loadingProfileDetails=!0;var t=_user_id;_targetUserId&&(t=_targetUserId);var a="?UserId="+t;o.get("/eyex-lite/controllers/users/getUser.php"+encodeURI(a)).success(function(t){if(t.RowsReturned>0)if(1==t.Data[0].archive)window.location="/eyex-lite/error/not-found.php";else{var a=t.Data[0];if(e.loadingProfileDetails=!1,e.profileDetails=!0,e.profileName=a.name,e.profileStatus=a.status,e.email=a.username,a.apartment||a.street_1||a.suite||a.country||a.postcode){var r="";a.apartment&&(r+=a.apartment+" "),a.street_1&&(r+=a.street_1+" "),a.suite&&(r+=a.suite+" "),a.country&&(r+=a.country+" "),a.postcode&&(r+=a.postcode),e.address=r}else e.address=null;if(e.primaryPhone=null,e.secondaryPhone=null,a.sip&&a.sip_cc){var n=a.sip;"1800"!=a.sip&&(n="+("+a.sip_cc+")");var i=n+" "+a.sip;e.primaryPhone=i}if(a.sip2&&a.sip2_cc){var n=a.sip2;"1800"!=a.sip2&&(n="+("+a.sip2_cc+")");var i=n+" "+a.sip2;e.secondaryPhone=i}e.extension=null,a.profile_picture?$("#profilePicture").prop("src",a.profile_picture):$("#profilePicture").prop("src","/eyex-lite/public/img/avatar-rect-md.png"),a.extension_number&&o.get("/eyex-lite/controllers/company/getCompanyDetails.php").success(function(o){if(o.RowsReturned>0){var t=o.Data[0];if(t.sip&&t.sip_cc){var r=t.sip;"1800"!=t.sip&&(r="+("+t.sip_cc+")");var n=r+" "+t.sip;e.companyPhone=n,e.extension="ext. "+a.extension_number}}})}else window.location="/eyex-lite/error/not-found.php"})},c=function(){e.loadingActivities=!0;var a=_user_id;_targetUserId&&(a=_targetUserId);var r="?UserId="+a;r+="?ClockType=I,O,T,X,N",r+="&SkipSize=0",r+="&PageSize=15",o.get("/eyex-lite/controllers/access/getAccess.php"+encodeURI(r)).success(function(o){if(e.loadingActivities=!1,o.RowsReturned>0){e.activitiesExist=!0;for(var a=0;a<o.RowsReturned;a++)o.Data[a].login_time=t.timeSince(moment(moment(o.Data[a].login_time).format("YYYY-MM-DDTHH:mm:ss+0000")).local()),"O"==o.Data[a].clock_type?o.Data[a].activity="Clocked out":"I"==o.Data[a].clock_type?o.Data[a].activity="Clocked in":"X"==o.Data[a].clock_type?o.Data[a].activity="Exited":"N"==o.Data[a].clock_type?o.Data[a].activity="Entered":"T"==o.Data[a].clock_type&&(o.Data[a].activity="Tap and accessed");e.activities=o.Data}else e.activitiesNoExist=!0})},d=function(){var t=_user_id;_targetUserId&&(t=_targetUserId);var a=moment(moment({hour:0,minute:0}).utc()).format("YYYY-MM-DDTHH:mm:ss"),r=moment(moment({hour:23,minute:59}).utc()).format("YYYY-MM-DDTHH:mm:ss"),n="?UserId="+t;n+="&ClockType=I,O",n+="&LoginTimeStart="+a,n+="&LoginTimeEnd="+r,o.get("/eyex-lite/controllers/access/getAccess.php"+encodeURI(n)).success(function(o){if(o.RowsReturned>0){var t=$linq(o.Data).where("x => x.clock_type == 'I'").toArray(),a=$linq(o.Data).where("x => x.clock_type == 'O'").toArray();if(t.length>0){var r=$linq(t).min("x => x.login_time");e.clockInTime=moment(moment(moment(r).format("YYYY-MM-DDTHH:mm:ss+0000")).local()).format("h:mma"),e.clockInExist=!0}else e.clockInNoExist=!0;if(a.length>0){var n=$linq(o.Data).maxBy("x => x.login_time");"O"==n.clock_type?(e.clockOutExist=!0,e.clockOutTime=moment(moment(moment(n.login_time).format("YYYY-MM-DDTHH:mm:ss+0000")).local()).format("h:mma")):e.clockOutNoExist=!0}else e.clockOutNoExist=!0;e.clockInTimeRaw=o.Data[0].login_time,e.clockOutTimeRaw=o.Data[0].login_time}else e.clockInNoExist=!0,e.clockOutNoExist=!0;e.clockInLoaded=!0,e.clockOutLoaded=!0})},s=function(){var t=_user_id;_targetUserId&&(t=_targetUserId);var a="?UserId="+t;a+="&SkipSize=0",a+="&PageSize=14",o.get("/eyex-lite/controllers/access/getDailyClockInOutTime.php"+encodeURI(a)).success(function(o){console.log(o);for(var t=0;t<o.RowsReturned;t++){var a=parseInt(moment(moment(o.Data[t].clock_in).format("YYYY-MM-DDTHH:mm:ss")).format("HH")),r=parseInt(moment(moment(o.Data[t].clock_in).format("YYYY-MM-DDTHH:mm:ss")).format("m"))/60,n=a+r,i=23.99;if(o.Data[t].clock_out){var c=parseInt(moment(moment(o.Data[t].clock_out).format("YYYY-MM-DDTHH:mm:ss")).format("HH")),d=parseInt(moment(moment(o.Data[t].clock_out).format("YYYY-MM-DDTHH:mm:ss")).format("m"))/60;i=c+d}o.Data[t].clock_in=n,o.Data[t].clock_out=i,o.Data[t].clock_in_date=moment(moment(o.Data[t].clock_in_date).format("YYYY-MM-DDTHH:mm:ss")).format("DD MMM"),o.Data[t].clocked_out||(e.clockOutCount+=1,e.usuallyDoesntClockOut=!0)}l(o.Data),u(o.Data)})},l=function(o){if(o.length>0){$("#historicalTimeInExists").show();for(var t=new Array,r=new Array,n=new Array,i=0;i<o.length;i++)t.unshift(o[i].clock_in_date),r.unshift(o[i].clock_in),n.unshift(o[i].clock_in);var c=new Array,d=a.median(n),s=Math.floor(d),l=d-Math.floor(d);60*l>45?(s+=1,l=0):l=30*((60*l+7.5)/30|0)%60/60,d=s+l;for(var u=0;u<o.length;u++)c.push(d);if(d){var m=Math.floor(d),p=Math.floor(d%1*60),v=moment({hour:m,minute:p}).format("h:mm a");e.usuallyClocksIn="Clocks in "+v}else e.usuallyClocksIn="--";$("#clockInStats").highcharts({chart:{type:"line"},title:{text:null},xAxis:{categories:t},yAxis:{title:{text:"Time"},labels:{enabled:!1}},plotOptions:{line:{enableMouseTracking:!0}},tooltip:{shared:!0,crosshairs:!0,formatter:function(){if(this.points[0]&&this.points[1]){var e=Math.floor(this.points[0].y),o=Math.floor(this.points[0].y%1*60),t=Math.floor(this.points[1].y),a=Math.floor(this.points[1].y%1*60);e>=24&&(e-=24),t>=24&&(t-=24);var r="<b>"+this.x+"</b><br />",n="<p>Clocks in at <b>"+moment({hour:e,minute:o}).format("h:mm a")+"</b></p><br/>";n+="<p>Usually Clocks In Around <b>"+moment({hour:t,minute:a}).format("h:mm a")+"</b></p>"}else{var t=Math.floor(this.points[0].y),a=Math.floor(this.points[0].y%1*60);t>=24&&(t-=24);var r="<b>"+this.x+"</b><br />",n="<p>Usually Clocks In <b>"+moment({hour:t,minute:a}).format("h:mm a")+"</b></p>"}return r+n}},series:[{name:"Clock In",data:r,color:"#769600",dataLabels:{enabled:!0,formatter:function(){if(this.y){var e=Math.floor(this.y),o=Math.floor(this.y%1*60);return e>=24&&(e-=24),moment({hour:e,minute:o}).format("h:mm a")}}}},{name:"Usually Clock In",data:c,color:"#364600",dataLabels:{enabled:!1,formatter:function(){if(this.y){var e=Math.floor(this.y),o=Math.floor(this.y%1*60);return e>=24&&(e-=24),moment({hour:e,minute:o}).format("h:mm a")}}}}]})}else $("#historicalTimeInExists").hide(),e.historicalTimeInNoExists=!0},u=function(o){if(o.length>0){$("#historicalTimeOutExists").show();for(var t=new Array,n=new Array,i=new Array,c=0;c<o.length;c++){t.unshift(o[c].clock_in_date);var d=new Object;o[c].clocked_out?(d.y=o[c].clock_out,d.clock_out_next_day=o[c].clock_out_next_day,d.clock_out_next_day_offset=o[c].clock_out_next_day_offset,n.unshift(d)):(d.y=null,n.unshift(d)),i.unshift(o[c].clock_out)}for(var s=new Array,l=a.median(i),u=0;u<o.length;u++)s.push(l);var m=moment().format("DD MMM");if(m==t[t.length-1]){var p=o[0].clocked_out;p||(t.pop(),n.pop(),s.pop())}if(l){var v=Math.floor(l),f=Math.floor(l%1*60),h=moment({hour:v,minute:f}).format("h:mm a");e.usuallyClocksOut=e.clockOutCount>7?"Doesn't clock out":"Clocks out "+h}else e.usuallyClocksOut="--";$("#clockOutStats").highcharts({chart:{type:"line"},title:{text:null},xAxis:{categories:t},yAxis:{title:{text:"Time"},labels:{enabled:!1}},plotOptions:{line:{enableMouseTracking:!0}},tooltip:{shared:!0,crosshairs:!0,formatter:function(){if(this.points[0]&&this.points[1]){var o=Math.floor(this.points[0].y),t=Math.floor(this.points[0].y%1*60),a=Math.floor(this.points[1].y),n=Math.floor(this.points[1].y%1*60);o>=24&&(o-=24),a>=24&&(a-=24);var i="<b>"+this.x+"</b><br />",c="";c+=this.points[0].point.clock_out_next_day?"<p>Clocks Out at <b>"+moment({hour:o,minute:t}).format("h:mm a")+" (+"+this.points[0].point.clock_out_next_day_offset+" "+r.pluralize(this.points[0].point.clock_out_next_day_offset,"day")+")</b></p><br />":"<p>Clocks Out at <b>"+moment({hour:o,minute:t}).format("h:mm a")+"</b></p><br />",c+=e.usuallyDoesntClockOut?"<p>Usually doesn't clock out. System takes default knock off hours - <b>"+moment({hour:a,minute:n}).format("h:mm a")+"</b></p>":"<p>Usually Clocks Out <b>"+moment({hour:a,minute:n}).format("h:mm a")+"</b></p>"}else{var a=Math.floor(this.points[0].y),n=Math.floor(this.points[0].y%1*60);a>=24&&(a-=24);var i="<b>"+this.x+"</b><br />",c="<p><b>Did not clock out</b></p><br />";c+=e.usuallyDoesntClockOut?"<p>Usually doesn't clock out. System takes default knock off hours - <b>"+moment({hour:a,minute:n}).format("h:mm a")+"</b></p><br />":"<p>Usually Clocks Out <b>"+moment({hour:a,minute:n}).format("h:mm a")+"</b></p><br/>"}return i+c}},series:[{name:"Clock Out",data:n,color:"#930023",dataLabels:{enabled:!0,formatter:function(){if(this.y){var e=Math.floor(this.y),o=Math.floor(this.y%1*60);return e>=24&&(e-=24),this.point.clock_out_next_day?moment({hour:e,minute:o}).format("h:mm a")+" (+"+this.point.clock_out_next_day_offset+" "+r.pluralize(this.point.clock_out_next_day_offset,"day")+")":moment({hour:e,minute:o}).format("h:mm a")}}}},{name:"Usually Clock Out",data:s,color:"#340000",dataLabels:{enabled:!1,formatter:function(){if(this.y){var e=Math.floor(this.y),o=Math.floor(this.y%1*60);return e>=24&&(e-=24),moment({hour:e,minute:o}).format("h:mm a")}}}}]})}else $("#historicalTimeOutExists").hide(),e.historicalTimeOutNoExists=!0};i(),c(),d(),n(),s()}]),angular.module("eyexApp.setupController",[]).controller("setupController",["$scope","$http","paramsServices","validationServices",function(e,o,t,a){$(".tb-mac-address").each(function(){$(this).keyup(function(){2==$(this).val().length&&$(this).parent().next().find('[type="text"]').length>0&&$(this).parent().next().find('[type="text"]')[0].focus()})});var r=t.getParameterByName("step");_currentStep||"company"!=r&&"visitor-station"!=r&&"office-station"!=r?_currentStep!=r&&"company"==_currentStep?window.location="/eyex-lite/setup.php?step=company":_currentStep!=r&&"visitor-station"==_currentStep?window.location="/eyex-lite/setup.php?step=visitor-station":_currentStep!=r&&"complete"!=r&&"office-station"==_currentStep?window.location="/eyex-lite/setup.php?step=office-station":"company"==r?$("#step1").fadeIn("fast"):"visitor-station"==r?$("#step2").fadeIn("fast"):"office-station"==r?$("#step3").fadeIn("fast"):"complete"==r?$("#stepFinal").fadeIn("fast"):window.location="/eyex-lite/setup.php?step=company":window.location="/eyex-lite/setup.php?step=complete",$("#btn-next-step-1").click(function(){n(function(){$("#step1").fadeOut("fast",function(){window.location="/eyex-lite/setup.php?step=visitor-station"})})}),$("#btn-next-step-2").click(function(){i(function(){$("#step2").fadeOut("fast",function(){window.location="/eyex-lite/setup.php?step=office-station"})})}),$("#btn-next-step-3").click(function(){c(function(){$("#step3").fadeOut("fast",function(){window.location="/eyex-lite/setup.php?step=complete"})})}),$("#btn-skip-step-3").click(function(){$("#step3").fadeOut("fast",function(){window.location="/eyex-lite/setup.php?step=complete"})});var n=function(t){var r=e.tbCompanyName,n=e.tbCompanyEmail,i=e.tbCompanyPassword,c=e.tbConfirmPassword,d=a.validateRequiredField(r),s=a.validateEmail(n,!0),l=a.validateRequiredLength(i,!0,null,8),u=a.validateRequiredSimilarField(c,!0,null,i);if(d?($("#tbCompanyNameError").show(),$("#tbCompanyNameError").text(d)):($("#tbCompanyNameError").text(""),$("#tbCompanyNameError").hide()),s?($("#tbCompanyEmailError").show(),$("#tbCompanyEmailError").text(s)):($("#tbCompanyEmailError").text(""),$("#tbCompanyEmailError").hide()),l?($("#tbCompanyPasswordError").show(),$("#tbCompanyPasswordError").text(l)):($("#tbCompanyPasswordError").text(""),$("#tbCompanyPasswordError").hide()),u?($("#tbConfirmPasswordError").show(),$("#tbConfirmPasswordError").text(u)):($("#tbConfirmPasswordError").text(""),$("#tbConfirmPasswordError").hide()),!(d||s||l||u)){var m=new Object;m.Name=r,m.Password=i,m.Username=n,m.Type="company",m.AuthorizationLevel=400,o.post("/eyex-lite/controllers/users/addUser.php",m).success(function(e){e.Error?window&&console.log(e):t()}).error(function(e){window&&console.log(e)})}},i=function(t){var r=e.tbVsId1,n=e.tbVsId2,i=e.tbVsId3,c=e.tbVsId4,d=e.tbVsId5,s=e.tbVsId6,l=e.tbVsDeviceName,u="";r&&n&&i&&c&&d&&s&&(u=e.tbVsId1+e.tbVsId2+e.tbVsId3+e.tbVsId4+e.tbVsId5+e.tbVsId6);var m=a.validateAlphaNumeric(u,!0),p=a.validateRequiredField(l);if(p?($("#deviceVsNameError").show(),$("#deviceVsNameError").text(p)):($("#deviceVsNameError").text(""),$("#deviceVsNameError").hide()),m?($("#deviceIdError").show(),$("#deviceIdError").text(m)):($("#deviceIdError").text(""),$("#deviceIdError").hide()),u.length<12)return $("#deviceIdError").show(),void $("#deviceIdError").text("Invalid MAC Address");if($("#deviceIdError").text(""),$("#deviceIdError").hide(),!(m&&u.length<12)){var v=new Object;v.DeviceId=u,v.DeviceName=l,v.DeviceType="VS",o.post("/eyex-lite/controllers/device/addDevice.php",v).success(function(e){e.Error?window&&console.log(e):t()}).error(function(e){window&&console.log(e)})}},c=function(t){var r=e.tbOsId1,n=e.tbOsId2,i=e.tbOsId3,c=e.tbOsId4,d=e.tbOsId5,s=e.tbOsId6,l=e.tbOsDeviceName,u="";r&&n&&i&&c&&d&&s&&(u=e.tbOsId1+e.tbOsId2+e.tbOsId3+e.tbOsId4+e.tbOsId5+e.tbOsId6);var m=a.validateAlphaNumeric(u,!0),p=a.validateRequiredField(l);if(p?($("#deviceOsNameError").show(),$("#deviceOsNameError").text(p)):($("#deviceOsNameError").text(""),$("#deviceOsNameError").hide()),m)return $("#deviceIdOsError").show(),void $("#deviceIdOsError").text(m);if($("#deviceIdOsError").text(""),$("#deviceIdOsError").hide(),u.length<12)return $("#deviceIdOsError").show(),void $("#deviceIdOsError").text("Invalid MAC Address");if($("#deviceIdOsError").text(""),$("#deviceIdOsError").hide(),!(m&&p&&u.length<12)){var v=new Object;v.DeviceId=u,v.DeviceName=l,v.DeviceType="OS",o.post("/eyex-lite/controllers/device/addDevice.php",v).success(function(e){e.Error?window&&console.log(e):t()}).error(function(e){window&&console.log(e)})}}}]),angular.module("eyexApp.sipSettingsController",[]).controller("sipSettingsController",["$scope","$http","validationServices",function(e,o,t){var a=function(){$("#tbSipUsername").focus(),e.tbSipUsername="",e.tbSipHost="",e.tbSipPassword=""},r=function(){$("#loadSip").modal({keyboard:!1,backdrop:"static"}),o.get("/eyex-lite/controllers/sip/getSip.php").success(function(o){$("#loadSip").modal("hide"),o.RowsReturned>0&&(e.tbSipUsername=o.Data[0].username,e.tbSipHost=o.Data[0].host,e.sipId=o.Data[0].id)})};e.changeSipSettings=function(){var n=e.tbSipUsername,i=e.tbSipHost,c=e.tbSipPassword,d=t.validateRequiredField(n),s=t.validateRequiredField(i),l=t.validateRequiredField(c);if(d?(e.sipUsernameError=!0,e.valSipUsername=d):(e.valSipUsername="",e.sipUsernameError=!1),s?(e.sipHostError=!0,e.valSipHost=s):(e.valSipHost="",e.sipHostError=!1),l?(e.sipPasswordError=!0,e.valSipPassword=l):(e.valSipPassword="",e.sipPasswordError=!1),d||s||l);else{$("#modalEditSip").modal({backdrop:"static",keyboard:!1}),$("input").blur();var u=new Object;u.Username=n,u.Host=i,u.Password=c,e.sipId?(u.SipProviderId=e.sipId,o.post("/eyex-lite/controllers/sip/updateSip.php",u).success(function(o){$("#modalEditSip").modal("hide"),console.log(o),o.Error?window&&console.log(o.ErrorDesc):(e.updateSuccess=!0,e.successMessage="SIP Settings updated",e.overallError=!1,e.valError="",a(),r())}).error(function(e){window&&console.log(e)})):o.post("/eyex-lite/controllers/sip/addSip.php",u).success(function(o){$("#modalEditSip").modal("hide"),o.Error?window&&console.log(o.ErrorDesc):(e.updateSuccess=!0,e.successMessage="SIP Settings updated",e.overallError=!1,e.valError="",a(),r())}).error(function(e){window&&console.log(e)})}},e.deleteSip=function(){if(e.sipId){var t=new Object;t.SipId=e.sipId,o.post("/eyex-lite/controllers/sip/deleteSip.php",t).success(function(o){$("#modalEditSip").modal("hide"),o.Error?window&&console.log(o.ErrorDesc):(e.updateSuccess=!0,e.successMessage="SIP Settings updated",e.overallError=!1,e.valError="",a(),r(),e.sipId=null)}).error(function(e){window&&console.log(e)})}},a(),r()}]);var _countryData=[{name:"Afghanistan",cca2:"AF",code:"93"},{name:"Albania",cca2:"AL",code:"355"},{name:"Algeria",cca2:"DZ",code:"213"},{name:"American Samoa",cca2:"AS",code:"1684"},{name:"Andorra",cca2:"AD",code:"376"},{name:"Angola",cca2:"AO",code:"244"},{name:"Anguilla",cca2:"AI",code:"1264"},{name:"Antigua and Barbuda",cca2:"AG",code:"1268"},{name:"Argentina",cca2:"AR",code:"54"},{name:"Armenia",cca2:"AM",code:"374"},{name:"Aruba",cca2:"AW",code:"297"},{name:"Australia",cca2:"AU",code:"61"},{name:"Austria",cca2:"AT",code:"43"},{name:"Azerbaijan",cca2:"AZ",code:"994"},{name:"Bahamas",cca2:"BS",code:"1242"},{name:"Bahrain",cca2:"BH",code:"973"},{name:"Bangladesh",cca2:"BD",code:"880"},{name:"Barbados",cca2:"BB",code:"1246"},{name:"Belarus",cca2:"BY",code:"375"},{name:"Belgium",cca2:"BE",code:"32"},{name:"Belize",cca2:"BZ",code:"501"},{name:"Benin",cca2:"BJ",code:"229"},{name:"Bermuda",cca2:"BM",code:"1441"},{name:"Bhutan",cca2:"BT",code:"975"},{name:"Bolivia",cca2:"BO",code:"591"},{name:"Bosnia and Herzegovina",cca2:"BA",code:"387"},{name:"Botswana",cca2:"BW",code:"267"},{name:"Brazil",cca2:"BR",code:"55"},{name:"Brunei Darussalam",cca2:"BN",code:"673"},{name:"Bulgaria",cca2:"BG",code:"359"},{name:"Burkina Faso",cca2:"BF",code:"226"},{name:"Burundi",cca2:"BI",code:"257"},{name:"Cambodia",cca2:"KH",code:"855"},{name:"Cameroon",cca2:"CM",code:"237"},{name:"Canada",cca2:"CA",code:"1"},{name:"Cape Verde",cca2:"CV",code:"238"},{name:"Cayman Islands",cca2:"KY",code:"1345"},{name:"Central African Republic",cca2:"CF",code:"236"},{name:"Chad",cca2:"TD",code:"235"},{name:"Chile",cca2:"CL",code:"56"},{name:"China",cca2:"CN",code:"86"},{name:"Colombia",cca2:"CO",code:"57"},{name:"Comoros",cca2:"KM",code:"269"},{name:"Congo (DRC)",cca2:"CD",code:"243"},{name:"Congo (Republic)",cca2:"CG",code:"242"},{name:"Cook Islands",cca2:"CK",code:"682"},{name:"Costa Rica",cca2:"CR",code:"506"},{name:"Côte d'Ivoire",cca2:"CI",code:"225"},{name:"Croatia",cca2:"HR",code:"385"},{name:"Cuba",cca2:"CU",code:"53"},{name:"Cyprus",cca2:"CY",code:"357"},{name:"Czech Republic",cca2:"CZ",code:"420"},{name:"Denmark",cca2:"DK",code:"45"},{name:"Djibouti",cca2:"DJ",code:"253"},{name:"Dominica",cca2:"DM",code:"1767"},{name:"Dominican Republic",cca2:"DO",code:"1809"},{name:"Ecuador",cca2:"EC",code:"593"},{name:"Egypt",cca2:"EG",code:"20"},{name:"El Salvador",cca2:"SV",code:"503"},{name:"Equatorial Guinea",cca2:"GQ",code:"240"},{name:"Eritrea",cca2:"ER",code:"291"},{name:"Estonia",cca2:"EE",code:"372"},{name:"Ethiopia",cca2:"ET",code:"251"},{name:"Faroe Islands",cca2:"FO",code:"298"},{name:"Fiji",cca2:"FJ",code:"679"},{name:"Finland",cca2:"FI",code:"358"},{name:"France",cca2:"FR",code:"33"},{name:"French Polynesia",cca2:"PF",code:"689"},{name:"Gabon",cca2:"GA",code:"241"},{name:"Gambia",cca2:"GM",code:"220"},{name:"Georgia",cca2:"GE",code:"995"},{name:"Germany",cca2:"DE",code:"49"},{name:"Ghana",cca2:"GH",code:"233"},{name:"Gibraltar",cca2:"GI",code:"350"},{name:"Greece",cca2:"GR",code:"30"},{name:"Greenland",cca2:"GL",code:"299"},{name:"Grenada",cca2:"GD",code:"1473"},{name:"Guadeloupe",cca2:"GP",code:"590"},{name:"Guam",cca2:"GU",code:"1671"},{name:"Guatemala",cca2:"GT",code:"502"},{name:"Guernsey",cca2:"GG",code:"44"},{name:"Guinea",cca2:"GN",code:"224"},{name:"Guinea-Bissau",cca2:"GW",code:"245"},{name:"Guyana",cca2:"GY",code:"592"},{name:"Haiti",cca2:"HT",code:"509"},{name:"Honduras",cca2:"HN",code:"504"},{name:"Hong Kong",cca2:"HK",code:"852"},{name:"Hungary",cca2:"HU",code:"36"},{name:"Iceland",cca2:"IS",code:"354"},{name:"India",cca2:"IN",code:"91"},{name:"Indonesia",cca2:"ID",code:"62"},{name:"Iran",cca2:"IR",code:"98"},{name:"Iraq",cca2:"IQ",code:"964"},{name:"Ireland",cca2:"IE",code:"353"},{name:"Isle of Man",cca2:"IM",code:"44"},{name:"Israel",cca2:"IL",code:"972"},{name:"Italy",cca2:"IT",code:"39"},{name:"Jamaica",cca2:"JM",code:"1876"},{name:"Japan",cca2:"JP",code:"81"},{name:"Jersey",cca2:"JE",code:"44"},{name:"Jordan",cca2:"JO",code:"962"},{name:"Kazakhstan",cca2:"KZ",code:"7"},{name:"Kenya",cca2:"KE",code:"254"},{name:"Kiribati",cca2:"KI",code:"686"},{name:"Kuwait",cca2:"KW",code:"965"},{name:"Kyrgyzstan",cca2:"KG",code:"996"},{name:"Laos",cca2:"LA",code:"856"},{name:"Latvia",cca2:"LV",code:"371"},{name:"Lebanon",cca2:"LB",code:"961"},{name:"Lesotho",cca2:"LS",code:"266"},{name:"Liberia",cca2:"LR",code:"231"},{name:"Libya",cca2:"LY",code:"218"},{name:"Liechtenstein",cca2:"LI",code:"423"},{name:"Lithuania",cca2:"LT",code:"370"},{name:"Luxembourg",cca2:"LU",code:"352"},{name:"Macao",cca2:"MO",code:"853"},{name:"Macedonia",cca2:"MK",code:"389"},{name:"Madagascar",cca2:"MG",code:"261"},{name:"Malawi",cca2:"MW",code:"265"},{name:"Malaysia",cca2:"MY",code:"60"},{name:"Maldives",cca2:"MV",code:"960"},{name:"Mali",cca2:"ML",code:"223"},{name:"Malta",cca2:"MT",code:"356"},{name:"Marshall Islands",cca2:"MH",code:"692"},{name:"Martinique",cca2:"MQ",code:"596"},{name:"Mauritania",cca2:"MR",code:"222"},{name:"Mauritius",cca2:"MU",code:"230"},{name:"Mexico",cca2:"MX",code:"52"},{name:"Micronesia",cca2:"FM",code:"691"},{name:"Moldova",cca2:"MD",code:"373"},{name:"Monaco",cca2:"MC",code:"377"},{name:"Mongolia",cca2:"MN",code:"976"},{name:"Montenegro",cca2:"ME",code:"382"},{name:"Montserrat",cca2:"MS",code:"1664"},{name:"Morocco",cca2:"MA",code:"212"},{name:"Mozambique",cca2:"MZ",code:"258"},{name:"Myanmar (Burma)",cca2:"MM",code:"95"},{name:"Namibia",cca2:"NA",code:"264"},{name:"Nauru",cca2:"NR",code:"674"},{name:"Nepal",cca2:"NP",code:"977"},{name:"Netherlands",cca2:"NL",code:"31"},{name:"New Caledonia",cca2:"NC",code:"687"},{name:"New Zealand",cca2:"NZ",code:"64"},{name:"Nicaragua",cca2:"NI",code:"505"},{name:"Niger",cca2:"NE",code:"227"},{name:"Nigeria",cca2:"NG",code:"234"},{name:"North Korea",cca2:"KP",code:"850"},{name:"Norway",cca2:"NO",code:"47"},{name:"Oman",cca2:"OM",code:"968"},{name:"Pakistan",cca2:"PK",code:"92"},{name:"Palau",cca2:"PW",code:"680"},{name:"Palestinian Territory",cca2:"PS",code:"970"},{name:"Panama",cca2:"PA",code:"507"},{name:"Papua New Guinea",cca2:"PG",code:"675"},{name:"Paraguay",cca2:"PY",code:"595"},{name:"Peru",cca2:"PE",code:"51"},{name:"Philippines",cca2:"PH",code:"63"},{name:"Poland",cca2:"PL",code:"48"},{name:"Portugal",cca2:"PT",code:"351"},{name:"Puerto Rico",cca2:"PR",code:"1787"},{name:"Qatar",cca2:"QA",code:"974"},{name:"Réunion",cca2:"RE",code:"262"},{name:"Romania",cca2:"RO",code:"40"},{name:"Russian Federation",cca2:"RU",code:"7"},{name:"Rwanda",cca2:"RW",code:"250"},{name:"Saint Kitts and Nevis",cca2:"KN",code:"1869"},{name:"Saint Lucia",cca2:"LC",code:"1758"},{name:"Saint Vincent and the Grenadines",cca2:"VC",code:"1784"},{name:"Samoa",cca2:"WS",code:"685"},{name:"San Marino",cca2:"SM",code:"378"},{name:"São Tomé and Príncipe",cca2:"ST",code:"239"},{name:"Saudi Arabia",cca2:"SA",code:"966"},{name:"Senegal",cca2:"SN",code:"221"},{name:"Serbia",cca2:"RS",code:"381"},{name:"Seychelles",cca2:"SC",code:"248"},{name:"Sierra Leone",cca2:"SL",code:"232"},{name:"Singapore",cca2:"SG",code:"65"},{name:"Slovakia",cca2:"SK",code:"421"},{name:"Slovenia",cca2:"SI",code:"386"},{name:"Solomon Islands",cca2:"SB",code:"677"},{name:"Somalia",cca2:"SO",code:"252"},{name:"South Africa",cca2:"ZA",code:"27"},{name:"South Korea",cca2:"KR",code:"82"},{name:"Spain",cca2:"ES",code:"34"},{name:"Sri Lanka",cca2:"LK",code:"94"},{name:"Sudan",cca2:"SD",code:"249"},{name:"Suriname",cca2:"SR",code:"597"},{name:"Swaziland",cca2:"SZ",code:"268"},{name:"Sweden",cca2:"SE",code:"46"},{name:"Switzerland",cca2:"CH",code:"41"},{name:"Syrian Arab Republic",cca2:"SY",code:"963"},{name:"Taiwan, Province of China",cca2:"TW",code:"886"},{name:"Tajikistan",cca2:"TJ",code:"992"},{name:"Tanzania",cca2:"TZ",code:"255"},{name:"Thailand",cca2:"TH",code:"66"},{name:"Timor-Leste",cca2:"TL",code:"670"},{name:"Togo",cca2:"TG",code:"228"},{name:"Toll Free",cca2:"FREE",code:"1800"},{name:"Tonga",cca2:"TO",code:"676"},{name:"Trinidad and Tobago",cca2:"TT",code:"1868"},{name:"Tunisia",cca2:"TN",code:"216"},{name:"Turkey",cca2:"TR",code:"90"},{name:"Turkmenistan",cca2:"TM",code:"993"},{name:"Turks and Caicos Islands",cca2:"TC",code:"1649"},{name:"Tuvalu",cca2:"TV",code:"688"},{name:"Uganda",cca2:"UG",code:"256"},{name:"Ukraine",cca2:"UA",code:"380"},{name:"United Arab Emirates",cca2:"AE",code:"971"},{name:"United Kingdom",cca2:"GB",code:"44"},{name:"United States",cca2:"US",code:"1"},{name:"Uruguay",cca2:"UY",code:"598"},{name:"Uzbekistan",cca2:"UZ",code:"998"},{name:"Vanuatu",cca2:"VU",code:"678"},{name:"Vatican City",cca2:"VA",code:"379"},{name:"Venezuela",cca2:"VE",code:"58"},{name:"Viet Nam",cca2:"VN",code:"84"},{name:"Virgin Islands (British)",cca2:"VG",code:"1284"},{name:"Virgin Islands (U.S.)",cca2:"VI",code:"1340"},{name:"Western Sahara",cca2:"EH",code:"212"},{name:"Yemen",cca2:"YE",code:"967"},{name:"Zambia",cca2:"ZM",code:"260"},{name:"Zimbabwe",cca2:"ZW",code:"263"}];angular.module("eyexApp.countryServices",[]).factory("countryServices",["$http",function(){return{getCountries:function(){return _countryData}}}]),angular.module("eyexApp.dateTimeServices",[]).factory("dateTimeServices",["stringServices",function(e){return{hourPadLeft:function(e){return 10>e?"0"+e:e},timeSince:function(o){var t,a=moment(),r=a.diff(o,"seconds"),n=a.diff(o,"minutes"),i=a.diff(o,"hours"),c=a.diff(o,"days"),d=a.diff(o,"weeks"),s=a.diff(o,"months"),l="";return s>1?l="On "+moment(o).format("ddd MMM YYYY, h:mm a"):s?(t="month",l=s+" "+e.pluralize(s,t)+" ago on "+moment(o).format("DD MMM YYYY h:mma")):d?(t="week",l=d+" "+e.pluralize(d,t)+" ago on "+moment(o).format("DD MMM YYYY h:mma")):c?(t="day",l=c+" "+e.pluralize(c,t)+" ago on "+moment(o).format("DD MMM YYYY h:mma")):i?(t="hour",l=i+" "+e.pluralize(i,t)+" ago at "+moment(o).format("h:mma")):n?(t="min",l=n+" "+e.pluralize(n,t)+" ago"):r&&(t="s",l=r+t+" ago"),l}}}]),angular.module("eyexApp.eyexServices",[]).factory("eyexServices",["$http",function(e){return{checkCompanyLogoExists:function(){var e=$.ajax({type:"HEAD",url:"../../../comp_logo/co-logo.jpg",async:!1});return 200==e.status?!0:!1},checkUserProfilePicExists:function(e){var o=$.ajax({type:"HEAD",url:"../../../data/"+e+"/profile-pic.jpg",async:!1});return 200==o.status?!0:!1},deviceBroadcast:function(o){e.get("/eyex-lite/controllers/device/deviceBroadcast.php").success(function(e){o(e)}).error(function(e){o(e)})},rs485Broadcast:function(o){e.get("/eyex-lite/controllers/device/deviceBroadcast.php").success(function(){o()})}}}]),angular.module("eyexApp.loadServices",[]).factory("loadServices",function(){return{loadAjaxLoader:function(e,o,t,a,r,n){var i='<div class="modal fade ajax-loader" id="modal-'+e+'"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><h2 id="modal-title-'+e+'"></h2><p class="modal-text"><i class="fa fa-circle-o-notch fa-spin"></i> <span id="modal-text-'+e+'"></span></p></div></div></div></div>';$("#"+o).append(i),t&&$("#modal-title-"+e).text(t),a&&$("#modal-text-"+e).text(a),$("#modal-"+e).modal({keyboard:n,backdrop:r})},closeAjaxLoader:function(e){$("#modal-"+e).modal("hide")},confirmBox:function(e,o,t,a,r,n,i,c){var d='<div class="modal fade ajax-loader" id="confirmBox-'+e+'"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><h2 id="modal-title-'+e+'"></h2><p class="modal-text"><span id="modal-text-'+e+'"></span></p><div class="modal-controls"><button class="btn btn-link btn-close" id="btnCloseConfirm-'+e+'">Cancel</button><button class="btn btn-primary btn-confirm" id="btnConfirm-'+e+'">Confirm</button></div>';$("#"+o).append(d),t&&$("#modal-title-"+e).text(t),a&&$("#modal-text-"+e).text(a),$("#confirmBox-"+e).modal({keyboard:n,backdrop:r}),$("#btnConfirm-"+e).click(function(){i()}),$("#btnCloseConfirm-"+e).click(function(){c()})},closeConfirmBox:function(e){$("#confirmBox-"+e).modal("hide")}}}),angular.module("eyexApp.pageServices",[]).factory("pageServices",function(){return{loadPager:function(e,o,t){for(var a='<ul class="pagination"><li><a href="javascript:void(0)" id="prevPage"><i class="fa fa-chevron-left"></i></a></li>',r=0;o>r;r++){var n=r+1;a+=n==t?'<li class="active"><a href="javascript:void(0)" class="page-number" data-pagenum="'+n+'">'+n+"</a></li>":'<li><a href="javascript:void(0)" class="page-number" data-pagenum="'+n+'">'+n+"</a></li>"}a+='<li><a href="javascript:void(0)" id="nextPage"><i class="fa fa-chevron-right"></i></a></li>',$(e).html(a)}}}),angular.module("eyexApp.paramsServices",[]).factory("paramsServices",["$http",function(){return{getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=o.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}}}]);var sigmaVariablesAnalysis=function(e){for(var o,t={mean:0,variance:0,deviation:0},a=e.length,r=0,n=a;n--;r+=e[n]);for(o=t.mean=r/a,n=a,r=0;n--;r+=Math.pow(e[n]-o,2));return t.deviation=Math.sqrt(t.variance=r/a),t
},withinSigma=function(e,o,t){var a=e.mean-t*e.deviation,r=e.mean+t*e.deviation;return o>a&&r>o};angular.module("eyexApp.statisticsServices",[]).factory("statisticsServices",["$http","dateTimeServices",function(e,o){return{medianTime:function(e){if(e.length>1){e.sort();var t=Math.floor(e.length/2);if(e.length%2){var a=parseInt(e[t].substring(0,e[t].indexOf(":"))),r=e[t].substring(e[t].indexOf(":")+1);return a>23?(a-=24,o.hourPadLeft(a)+":"+r):e[t]}var a=parseInt(e[t-1].substring(0,e[t-1].indexOf(":"))),r=e[t-1].substring(e[t-1].indexOf(":")+1);return a>23?(a-=24,o.hourPadLeft(a)+":"+r):e[t-1]}return 1==e.length?e[0]:null},median:function(e,o){e.sort(function(e,o){return e-o});var t=Math.floor(e.length/2);return e.length%2?e[t]:o?Math.floor((e[t-1]+e[t])/2):(e[t-1]+e[t])/2},mode:function(e){if(0==e.length)return null;for(var o={},t=e[0],a=1,r=0;r<e.length;r++){var n=e[r];null==o[n]?o[n]=1:o[n]++,o[n]>a&&(t=n,a=o[n])}return t},modeArrays:function(e){if(0==e.length)return null;for(var o={},t=1,a=[e[0]],r=0;r<e.length;r++){var n=e[r];null==o[n]?o[n]=1:o[n]++,o[n]>t?(a=[n],t=o[n]):o[n]==t&&(a.push(n),t=o[n])}return a},sigmaArrange:function(e,o){for(var t=sigmaVariablesAnalysis(e),a=new Array,r=new Array,n=0;n<e.length;n++)withinSigma(t,e[n],o)?a.push(e[n]):r.push(e[n]);var i=new Object;return i.arranged=a,i.outliers=r,i}}}]),angular.module("eyexApp.stringServices",[]).factory("stringServices",function(){return{pluralize:function(e,o){var t=o.substr(o.length-1),a=["day"],r=!1;if(-1!=$.inArray(o,a)&&(r=!0),o){if(e>1){if(r)o+="s";else if("f"==t){var n=o.lastIndexOf("f");o=o.substring(0,n)+"ves"}else if("y"==t){var n=o.lastIndexOf("y");o=o.substring(0,n)+"ies"}else o+="s";return o}return o}return o},padFront:function(e,o){for(var t=e+"";t.length<o;)t="0"+t;return t}}}),angular.module("eyexApp.validationServices",[]).factory("validationServices",function(){return{validateRequiredField:function(e,o){return e?!1:o?o:"Required"},validateEmail:function(e,o,t,a){if(o){if(e){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r.test(e)?!1:a?a:"Invalid Email"}return t?t:"Required"}if(e){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r.test(e)?!1:a?a:"Invalid Email"}return"Unable to validate Email"},validateAlphaNumeric:function(e,o,t,a){if(o){if(e){var r=/^[a-z0-9]+$/i;return r.test(e)?!1:a?a:"Alphanumeric. Must not contain other characters"}return t?t:"Required"}if(e){var r=/^[a-z0-9]+$/i;return r.test(e)?!1:a?a:"Invalid"}return"Alphanumeric. Must not contain other characters"},validateRequiredLength:function(e,o,t,a,r){return o?e?e.length<a?r?r:a+" characters required":!1:t?t:"Required":e&&e.length<a?r?r:a+" characters required":!1},validateRequiredSimilarField:function(e,o,t,a,r){return o?e?e==a?!1:r?r:"Fields does not match":t?t:"Required":e?e==a?!1:r?r:"Fields does not match":!1},validateRequiredUrl:function(e,o,t,a){if(o){if(e){var r=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:[A-Za-z0-9].|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/;return r.test(e)?!1:a?a:"Invalid URL"}return t?t:"Required"}if(e){var r=/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:[A-Za-z0-9].|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/;return r.test(e)?!1:a?a:"Invalid URL"}return"Unable to validate URL"},validateRequiredInteger:function(e,o,t,a){return o?e?$.isNumeric(e)?!1:a?a:"Not a number":t?t:"Required":e?$.isNumeric(e)?!1:a?a:"Not a number":!1}}});